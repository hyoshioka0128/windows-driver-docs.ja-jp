---
title: プリンター インストールとプラグ アンド プレイ マネージャー
description: プリンター インストールとプラグ アンド プレイ マネージャー
ms.assetid: 1edc92f1-fcd9-4af0-957d-cd7ff2e40125
keywords:
- プラグアンドプレイ manager WDK 印刷
- 重複したインストール検出 WDK 印刷
- 重複するプリンターインストールの検出
ms.date: 04/20/2017
ms.localizationpriority: medium
ms.openlocfilehash: f34d121aef2f44f1f1ddce76854a6a9ccefb7f1f
ms.sourcegitcommit: 88f6e7355de9e0714057020557dc8c7831e90e7b
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 06/10/2020
ms.locfileid: "84638445"
---
# <a name="printer-installation-and-the-plug-and-play-manager"></a>プリンター インストールとプラグ アンド プレイ マネージャー

プラグアンドプレイマネージャーは、コンピューターのすべてのプラグアンドプレイイベントを処理し、すべてのデバイスに対して汎用的です。 プラグアンドプレイ manager については[プラグアンドプレイ](https://docs.microsoft.com/windows-hardware/drivers/kernel/implementing-plug-and-play)をご覧ください。 [プラグアンドプレイ](https://docs.microsoft.com/windows-hardware/drivers/kernel/introduction-to-plug-and-play)の概要では、プラグアンドプレイインストールの概要と、さまざまなカーネルモードおよびユーザーモードコンポーネントがどのように対話するかについて説明します。

## <a name="printer-installation-differences-between-windows-98me-and-windows-2000-and-later"></a>Windows 98/Me と Windows 2000 以降のプリンターのインストールの相違点

Windows 2000 以降のプラグアンドプレイアーキテクチャは、Windows 95/98/Me とは異なります。 最も大きな違いは次のとおりです。

- Windows 2000 以降に含まれるドライバーは、オペレーティングシステムのインストール時にインストールされる .cab ファイルに含まれています。 このファイルには、すべての種類のデバイスのすべてのプラグアンドプレイインボックスドライバーが含まれているため、ユーザーは通常、元のインストールメディアを使用してドライバーをインストールする必要はありません。

- 特定のドライバーをインストールするために、ユーザーの介入はほとんどまたはまったく必要ありません。 Microsoft によってデジタル署名された Windows 2000 以降のドライバーが driver.cab またはコンピューターに既にインストールされている場合、プラグアンドプレイは、ドライバーの署名を検証し、ユーザーの介入なしにドライバーをインストールします。 この種類のインストールは、サーバー側インストールと呼ばれます。 ドライバーがシステムで利用できない場合、またはドライバーが署名されていない場合、またはドライバーのインストールでユーザーとの対話が必要な場合 (ユーザーインターフェイス要素を使用)、プラグアンドプレイはクライアント側のインストールに戻ります。 インストールの種類の詳細については、「[デバイスのインストールコンポーネント](https://docs.microsoft.com/previous-versions/ff541277(v=vs.85))」のユーザーモードの PnP マネージャーに関する説明を参照してください。 ほとんどの場合、新しいプラグアンドプレイデバイスに接続してコンピューターを起動すると、デバイスがインストールされ、ユーザーがログオンしたときに使用できる状態になります。

インストールするドライバーをユーザーが選択できる必要がある場合は、 [**INF ControlFlags セクション**](https://docs.microsoft.com/windows-hardware/drivers/install/inf-controlflags-section)で InteractiveInstall ディレクティブを使用できます。 このディレクティブは、次の2つの状況でのみ使用できます。

1. 正しく定義されていないハードウェア Id を持つデバイスをインストールするには これは、ハードウェアデバイスのハードウェア ID が破損している場合、またはハードウェアベンダーが同じハードウェア ID を2つの異なるデバイスに割り当てた場合に発生する可能性があります。これは、ハードウェア設計ではエラーになります。

1. ジェネリッククラスインストーラーまたはオペレーティングシステムで提供されるドライバーを使用できないデバイスのドライバーをインストールするには

ハードウェア Id または互換性 Id が InteractiveInstall ディレクティブと共に一覧表示されている場合、セットアップでは、これらの Id に一致するプリンターのインストールがクライアント側に延期されるため、管理者がログオンするまでインストールは遅延されます。 管理者は、正しいドライバーファイルをインストールするように求められます。 これは、2つのプリンタードライバーが同じ*デバイス ID*を共有し、別のドライバーが必要な場合に便利です。

Windows 2000 以降とは対照的に、Windows 95/98/Me プラグアンドプレイでは、*ハードウェア ID* (順位 0) が一致する場合にのみ、ユーザーの介入なしにデバイスがインストールされます。 プラグアンドプレイデバイスのドライバーと*互換性のある ID* (順位 1) が一致するが、ハードウェア id が一致しない場合、インストールメディアから正しいドライバーを選択するように求めるメッセージがユーザーに表示されます。 (これは、ドライバーをインストールするために、ユーザーがインストールメディアを持っている必要があることを意味します)。

また、Windows 95/98/Me では、複数のデバイス (または複数のバス上の同様のデバイス) 用にドライバーが作成された場合、使用可能なすべてのハードウェア ID が INF ファイルに重複したドライバーエントリと共に一覧表示されない限り、互換性のある ID のみが一覧に表示されます。

## <a name="duplicate-installation-detection"></a>重複したインストールの検出

セットアップ時にプリンタークラスインストーラーを呼び出してプリンターをインストールすると、そのプリンターが既に手動でインストールされているかどうかがクラスインストーラーによって判断されます。 これを行うには、現在インストールされているプリンターのドライバー名とポート名、および INF ファイルに記載されているものとの完全一致を検索します。 ドライバーとポート名がこの2つのパラメーターに一致するインストール済みの印刷キューをクラスインストーラーが検出した場合、2番目の印刷キューはインストールされず、代わりに*devnode*エントリに関連付けられます。 これにより、同じデバイスに対して2番目の印刷キューを作成できなくなります。

多くの一般的なプリンターモデルは、同じハードウェア ID (HP DeskJet シリーズなど) を共有しています。 Windows 95/98/Me で、ユーザーがプラグアンドプレイによって検出された DeskJet モデルを手動でインストールした場合、ユーザーが適切なドライバーを選択すると、2つ目の印刷キューがインストールされます。 ユーザーがドライバーを選択していない場合は、コンピューターが再起動するたびにそのドライバーが表示されます。

Windows 2000 以降では、*ハードウェア id*と*互換性のある id*が一致するすべてのプリンターを一覧表示することで、この動作を回避しています。 複数の一致が見つかった場合、クラスインストーラーは、同じハードウェア ID と一致する印刷キューが既に存在するかどうかを確認します。 存在する場合、プラグアンドプレイマネージャーは2番目のキューをインストールしません。 それ以外の場合、ハードウェア ID の一致は互換性のある ID 一致にダウングレードされます。 これらのハードウェア Id が、INF ファイルの InteractiveInstall エントリ (「 [**Inf ControlFlags」セクション**](https://docs.microsoft.com/windows-hardware/drivers/install/inf-controlflags-section)を参照) にも記載されている場合、ユーザーはドライバーを選択するように求められます。
