---
title: データのフィルター処理 (以前のバージョン)
description: データのスループットを最適化するために、センサーデバイスは、必要なときにのみ発生するように、データ更新イベントにフィルター条件を適用する必要があります。
ms.assetid: 1895EC5C-08C1-4976-83F2-CD5A2B55338D
keywords:
- 感度の変更
- センサーの変更の感度
- CS
- 現在のレポートの間隔
- センサーの現在のレポートの間隔
- CRI
- データ更新イベント
- センサーイベント
- センサーイベント
- フィルター処理 (データを)
- データのフィルター処理
ms.date: 07/20/2018
ms.localizationpriority: medium
ms.openlocfilehash: d485f6ff82b2f9e2ee79c8ef2ca6e614890eb57a
ms.sourcegitcommit: 9102e34c3322d8697dbb6f9a1d78879147a73373
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 07/28/2020
ms.locfileid: "87264264"
---
# <a name="filtering-data-previous-version"></a>データのフィルター処理 (以前のバージョン)


データのスループットを最適化するために、センサーデバイスは、必要なときにのみ発生するように、データ更新イベントにフィルター条件を適用する必要があります。 このフィルター処理により、CPU 使用率が低下し (センサーのスループットが低下します)、電力消費量が少なくなります (センサーと CPU の両方)。

センサーデバイスのフィルター条件をサポートする2つの値 (またはプロパティ) があります。 1つ目は現在のレポート間隔 (CRI) で、2つ目は変更感度 (CS) です。 これらのプロパティはどちらも、センサーアプリケーションで設定できます。

現在のレポート間隔は、意味のある変更が発生したときにクライアントが受け取るデータ更新の最小期間 (ミリ秒単位) です。 変更の感度は、意味のある変更を指定するために使用される値 (または割合) です。

したがって、weather 局アプリケーションでは、6万 (または1分) の温度センサーの現在のレポート間隔 (CRI) を指定できます。 また、温度センサーは、(パーセンテージではなく) 変更感度の値を必要とします。 たとえば、この温度センサーによって摂氏が返され、変更感度値の温度が2.0 である場合、このセンサーは、要求されたレポート間隔 (この場合は1分) で温度が増加または2.0 減少したときに、データ更新イベントのみを発生させます。

アンビエント光センサー (ALS) は、変更の感度をパーセンテージとして指定する必要があるセンサーの例です。 たとえば、照度の [感度の変更] の値が2.0 である場合、このセンサーは値をパーセンテージとして解釈し、LUX 値が2% 増加した場合にのみデータ更新イベントを発生させます。

次の表は、6つの一般的なセンサー、それぞれに関連付けられているデータ、および対応する変更の感度を示しています。

| センサー             | Datafield              | 秘密度の値の変更           |
|--------------------|------------------------|------------------------------------|
| 光センサー       | LUX                    | lux での変更の割合                    |
| 加速度計      | アクセラレーション X         | アクセラレーション G-フォース               |
|                    | アクセラレーション Y         | アクセラレーション G-フォース               |
|                    | アクセラレーション Z         | アクセラレーション G-フォース               |
| 3D ジャイロ       | 速度 X        | 角速度 (1 秒あたりの度) |
|                    | 速度 Y        | 角速度 (1 秒あたりの度) |
|                    | 速度 Z        | 角速度 (1 秒あたりの度) |
| コンパス            | 磁気北部の見出し | 度                            |
|                    | 真北の見出し     | 度                            |
| Inclinometer       | Yaw                    | 度                            |
|                    | [Pitch] (傾斜)                  | 度                            |
|                    | Roll                   | 度                            |
| デバイスの向き | Quaternion             | 角度の移動                   |
|                    | 回転行列        | 角度の移動                   |

 

次の表に、推奨される現在のレポート間隔 (CRI) の既定値を示します。

| センサーの種類   | 推奨される既定のレポート間隔 |
|---------------|-------------------------------------|
| 環境光 | 5000                                |
| 加速度計 | 100                                 |
| Gyrometer     | 100                                 |
| コンパス       | 100                                 |
| Inclinometer  | 50                                  |
| 方向   | 50                                  |

 

次の表に、推奨される変更の感度 (CS) の既定値を示します。

|  センサーの種類  | 推奨される既定の変更の感度 |
|---------------|----------------------------------------|
| 環境光 | 50                                     |
| 加速度計 | 0.02                                   |
| Gyrometer     | 0.50                                   |
| コンパス       | 0.20                                   |
| Inclinometer  | 0.50                                   |
| 方向   | 0.50                                   |


## <a name="change-sensitivity-cs-for-the-inclinometer-and-orientation-sensors"></a>Inclinometer センサーと方向センサーの変更感度 (CS)


Inclinometer センサーと orientation センサーの変更感度は、2つの四元数の間の角度として計算する必要があります。 数学的には、次のように表現されます。

2 \* cos ⁻¹ (ドット積 (q1, q2))

この計算により、さまざまなタブレット (またはデバイス) の向き間の一貫性が確保します。

## <a name="effective-current-report-interval-cri-and-change-sensitivity-cs"></a>有効な現在のレポート間隔 (CRI) と変更の感度 (CS)


複数のアプリケーションで、特定のセンサーの現在のレポート間隔 (CRI) と変更感度 (CS) の両方のプロパティを設定できます。 要求されたプロパティを特定するのはドライバーの役割です。 ドライバーによって設定されるプロパティは、有効な現在のレポート間隔 (CRI) と有効な変更の区別 (E-CS) と呼ばれます。

## <a name="setting-the-e-cri-and-e-cs-for-client-applications"></a>クライアントアプリケーション用の E CRI と E-CS の設定


クライアントアプリケーションがセンサーへの接続を確立するたびに、ドライバーは CRI と E-CS の値を設定する必要があります。 これらの値は、クライアントコンテナーと呼ばれるものに格納されます。 次の表に、センサードライバーでサポートされている6つの方法を示し、ドライバーがクライアントコンテナーと CRI プロパティおよび E-CS プロパティを使用して実行する処理を指定します。

<table>
<colgroup>
<col width="50%" />
<col width="50%" />
</colgroup>
<tbody>
<tr class="odd">
<td>関心のあるイベント</td>
<td>イベントハンドラーのアクティビティ</td>
</tr>
<tr class="even">
<td>ISensorDriver:: OnClientConnect</td>
<td><p>クライアント項目をクライアントコンテナーに追加する</p>
<p>必要に応じて既定の CRI 値と CS 値を読み取ります。クライアントコンテナーに格納します。</p></td>
</tr>
<tr class="odd">
<td>ISensorDriver:: OnClientDisconnect</td>
<td><p>クライアントコンテナーからクライアントを削除し、残りのクライアントに基づいて、CRI と E CS を適宜設定します。</p></td>
</tr>
<tr class="even">
<td>ISensorDriver::OnClientSubscribeToEvents</td>
<td><p>対象のセンサーについて、"サブスクライブしているイベント" フィールド (true に設定) を更新します。 センサーからイベントレポートを有効にします。</p></td>
</tr>
<tr class="odd">
<td>ISensorDriver::OnClientUnSubscribeToEvents</td>
<td><p>対象のセンサーについて、"サブスクライブしているイベント" フィールド (false に設定) を更新します。 サブスクライバーが残っていない場合は、デバイスからのイベントレポートを無効にします。</p></td>
</tr>
<tr class="even">
<td>ISensorDriver::OnSetProperties</td>
<td><p>CS または CRI プロパティが設定されている場合は、適切なクライアントコンテナーフィールドを更新します。</p></td>
</tr>
<tr class="odd">
<td>IFileCallbackCleanup:: OnCleanupFile</td>
<td><p>クライアントがクラッシュしたか、応答を停止しました。 クライアントをクライアントコンテナーから削除する必要があります。</p></td>
</tr>
</tbody>
</table>

 

次の表は、4つの接続されたクライアントアプリケーションがある3D 加速度計のクライアントコンテナーを表しています。 これらのクライアントアプリ (2 番目と4番目の行に対応する) は、イベントをサブスクライブしています。

| クライアントファイルハンドル | イベントにサブスクライブ済み | CRI | CS (X) | CX (Y) | CS (Z) |
|--------------------|----------------------|-----|--------|--------|--------|
| FF80A267           | FALSE                | 50  | .001   | .001   | .001   |
| FF802489           | TRUE                 | 70  | . 02    | . 02    | . 02    |
| FF80D345           | FALSE                | 15  | NULL   | NULL   | NULL   |
| FF803287           | TRUE                 | 100 | . 005   | . 005   | . 005   |

 

ドライバーは、この一連の接続されたクライアントを評価した後、CRI と E CS に対して次の値を選択しました。

-   CRI: 70ms
-   E-CS 値: (最小しきい値を使用して1つの値に折りたたむことができます)
    -   X:.005
    -   Y:-005
    -   Z:. 005

この例では、イベントシンクセットを持たないクライアント (最初と3番目の行) は無視されます。これは、イベントのフィルター処理がこれらのクライアントに適用されないためです。

## <a name="filtering-data-update-events-by-evaluating-the-effective-cri-and-cs-values-e-cri-e-cs"></a>有効な CRI 値と CS 値を評価してデータ更新イベントをフィルター処理する (CRI、E-CS)


現在の CRI と E CS の値が決定され、センサーの接続状態が変化すると、センサーデバイスはこれらの値を使用して、接続されたクライアントアプリケーションに発生するイベントをフィルター処理します。 これらの値は、"現在の" データ値と前のデータ値の差と比較されます。 E-CRI 以上の期間について E CS の値を超えた場合、は、データイベントを発生させる必要があります。 唯一の例外は、クライアントが適切な通知を受信できるように、既定値が適用されている場合にセンサーデバイスを起動することです。

次の図は、データイベントが発生するタイミングを判断するために、生のセンサーデータのフィルター処理を評価する方法を示しています。

![時間フィルターセンサーデータ](images/cri-cs.png)

前の図では、図の下部にある赤のデータが生のセンサーデータを表しています。 緑の線は、データをポーリングするクライアント (この動作を実装する多くの方法の1つ) に返されるデータを表し、"X" 値はデータイベントが発生するタイミングを表します。 青色の線は、E-CS 境界のしきい値です (+/-E-CS は、最後のデータイベント値に対して相対的です)。

このイベントフィルター処理ロジックを実装することで、データ更新イベントの数が大幅に削減され、センサーデータの意味のある変更が発生した場合でもアプリケーションが通知を受け取ることができます。

## <a name="device-runtime-optimizations-for-data-filtering"></a>データのフィルター処理のためのデバイスランタイムの最適化


このセクションでは、センサードライバーを開発する際に考慮する必要があるいくつかのランタイム最適化について説明します。

### <a name="support-interrupts"></a>割り込みのサポート

ドライバーは、デバイスをポーリングするのではなく、割り込みに依存している必要があります。 これにより、パフォーマンスと電源管理が向上します。 これらの機能強化には、次のものがあります。

1.  デバイスは、現在の変更の感度とレポートの間隔に基づいて、電力の状態を下げることができます。
2.  割り込みを使用すると、ドライバーとセンサーファームウェアの両方での不要なコード実行を減らすことができます。
3.  割り込みを使用すると、バスアクティビティが減少します。

**メモ**   ドライバーが割り込みに依存していても、現在のレポートの間隔と変更の感度のロジックがドライバーに存在する場合、ドライバーはデータの更新間に多くの割り込みを受け取る可能性があります。 その結果、ドライバーは、現在のレポートの期間が経過するまで、割り込みを無効 (またはマスク) する必要がある場合があります。

 

### <a name="move-change-sensitivity-support-to-the-device"></a>変更感度のサポートをデバイスに移動する

センサーハードウェア (ファームウェア) でしきい値の検出がサポートされている場合は、この機能を使用して変更の感度をサポートする必要があります。 サポートをデバイスに移動し、対応する割り込みに応答することで、ドライバーの処理オーバーヘッドを削減できます。

### <a name="move-report-interval-support-to-the-devices"></a>レポート間隔のサポートをデバイスに移動する

センサーハードウェア (ファームウェア) がレポート間隔の概念をサポートしている場合は、この機能を使用する必要があります。

センサーがネイティブのレポート間隔サポートを提供していない場合は、現在のレポート間隔のサブセットに対して割り込みを無効にすることを検討してください。 この時間が経過すると、現在のデバイスデータが取得されます。

## <a name="related-topics"></a>関連トピック
[センサーの地理位置情報ドライバーのサンプル](https://docs.microsoft.com/windows-hardware/drivers/gnss/sensors-geolocation-driver-sample)



