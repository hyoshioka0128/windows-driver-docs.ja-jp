---
title: USB 3.0 データの構造
description: このトピックでは、USB 3.0 ホストコントローラードライバーで使用されるデータ構造について説明します。
ms.assetid: 39BD7413-48A5-4199-BA8E-D2A77E4D23F1
ms.date: 11/28/2017
ms.localizationpriority: medium
ms.openlocfilehash: a9a5893da22ddbcb113a94af61681a18bb364934
ms.sourcegitcommit: dadc9ced1670d667e31eb0cb58d6a622f0f09c46
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 06/09/2020
ms.locfileid: "84533837"
---
# <a name="usb-30-data-structures"></a>USB 3.0 データの構造

このトピックでは、USB 3.0 ホストコントローラードライバーで使用されるデータ構造について説明します。 これらのデータ構造を理解することで、 [USB 3.0](usb-3-extensions.md)および[Rcdrkd](rcdrkd-extensions.md)デバッガー拡張機能のコマンドを効果的に使用できるようになります。 ここに表示されるデータ構造には、 [USB 3.0 仕様](https://www.usb.org/documents)と一貫性のある名前が付いています。 USB 3.0 仕様に精通していると、拡張コマンドを使用して USB 3.0 ドライバーをデバッグできるようになります。

USB 3.0 ホストコントローラードライバーは、USB 3.0 コアドライバースタックの一部です。 詳細については、「 [USB ドライバースタックアーキテクチャ](https://docs.microsoft.com/windows-hardware/drivers/usbcon/usb-3-0-driver-stack-architecture)」を参照してください。

各 USB 3.0 ホストコントローラーは、最大255のデバイスを持つことができ、各デバイスには最大31のエンドポイントを含めることができます。 次の図は、1つのホストコントローラーと接続されているデバイスを表すデータ構造の一部を示しています。

![1つのホストコントローラーと、デバイスコンテキストがスロットとエンドポイントのコンテキストを持つ接続されているデバイスを表す usb 3.0 データ構造](images/usb3structures01.png)

## <a name="device-context-base-array"></a>デバイスコンテキストベース配列

デバイスコンテキストの基本配列は、デバイスコンテキスト構造へのポインターの配列です。 ホストコントローラーに接続されているデバイスごとに1つのデバイスコンテキスト構造があります。 要素 1 ~ 255 は、デバイスコンテキスト構造をポイントします。 要素0は、ホストコントローラーのコンテキスト構造を指します。

## <a name="device-context-and-slot-context"></a>デバイスコンテキストとスロットコンテキスト

デバイスコンテキスト構造体は、エンドポイントコンテキスト構造へのポインターの配列を保持します。 デバイス上のエンドポイントごとに1つのエンドポイントコンテキスト構造があります。 要素 1 ~ 31 は、エンドポイントコンテキスト構造を指します。 要素0は、デバイスのコンテキスト情報を保持するスロットコンテキスト構造体を指します。

## <a name="command-ring"></a>コマンドリング

コマンドリングは、ホストコントローラーにコマンドを渡すためにソフトウェアによって使用されます。 これらのコマンドの一部はホストコントローラーで行われ、ホストコントローラーに接続されている特定のデバイスで転送されます。

## <a name="event-ring"></a>イベントリング

イベントリングは、ソフトウェアにイベントを渡すためにホストコントローラーによって使用されます。 つまり、イベントリングは、アクションが完了したことをドライバーに通知するためにホストコントローラーが使用する構造体です。

## <a name="doorbell-register-array"></a>Doorbell Register 配列

Doorbell Register 配列は、ホストコントローラーに接続されているデバイスごとに1つずつ、Doorbell レジスタの配列です。 要素 1 ~ 255 は doorbell レジスタです。 要素0は、コマンドリングに保留中のコマンドがあるかどうかを示します。

ソフトウェアは、デバイスの doorbell register にコンテキスト情報を書き込むことによって実行するデバイス関連またはエンドポイント関連の作業があることをホストコントローラーに通知します。

次の図は、前の図の右側に続きます。 これには、単一のエンドポイントを表す追加のデータ構造が表示されます。

![データと tds を持つ複数の trbs を持つエンドポイントコンテキストを示す usb 3.0 データ構造](images/usb3structures02.png)

## <a name="transfer-ring"></a>転送リング

各エンドポイントには1つ以上の転送リングがあります。 転送リングは、転送要求ブロック (TRBs) の配列です。 各 TRB は、1つのユニットとしてハードウェアとメモリの間で転送される連続データ (最大 64 KB) のブロックを指します。

USB 3.0 コアスタックは、USB クライアントドライバーから転送要求を受信すると、転送のエンドポイントコンテキストを識別し、転送要求を1つまたは複数の転送記述子 (TDs) に分割します。 各 TD には、1つ以上の TRBs が含まれています。

## <a name="endpoint-context"></a>エンドポイントコンテキスト

エンドポイントコンテキスト構造体は、1つのエンドポイントのコンテキスト情報を保持します。 また、**デキュー**と**エンキュー**のメンバーもあります。このメンバーは、ハードウェアによって使用されている場所と、ソフトウェアによって追加される場所を追跡するために使用されます。

## <a name="related-topics"></a>関連トピック

[Windows 8 の USB デバッグのイノベーション](https://channel9.msdn.com/Events/BUILD/BUILD2011/HW-258P)
