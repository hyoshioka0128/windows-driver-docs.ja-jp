---
title: デバイス インストールの共同インストーラーのデバッグ
description: デバイス インストールの共同インストーラーのデバッグ
ms.assetid: a5cf3cec-bd61-49a6-b836-6759cd8c7d82
keywords:
- デバイスインストールの共同インストーラーのデバッグ
- インストールの共同インストーラーのデバッグ
- 共同インストーラーのデバッグ
ms.date: 05/23/2017
ms.localizationpriority: medium
ms.openlocfilehash: 734987cb7b563937f489d20c3caeaa75296c66bf
ms.sourcegitcommit: dadc9ced1670d667e31eb0cb58d6a622f0f09c46
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 06/09/2020
ms.locfileid: "84534783"
---
# <a name="debugging-a-device-installation-co-installer"></a>デバイス インストールの共同インストーラーのデバッグ


## <span id="ddk_debugging_dual_boot_machines_dbg"></span><span id="DDK_DEBUGGING_DUAL_BOOT_MACHINES_DBG"></span>


一部のハードウェアデバイスインストールパッケージには、デバイスのインストールを支援する*共同インストーラー*と呼ばれる DLL ファイルが含まれています。

共同インストーラーを他のモジュールと同じ方法でデバッグすることはできません。 これは、共同インストーラーが読み込まれる一意の方法によるものです。また、実行中のプロセスを中断する機会を開発者に提供することなく、多くのインストールシナリオが自動的に実行されるためです。

この問題を解決するには、プログラムを使用してデバイスをインストールします。 デバイスをインストールするアプリケーションにデバッガーをアタッチすると、共同インストーラー自体にアクセスできるようになります。 これを実現する最も簡単な方法は、Windows Driver Kit (WDK) に含まれている[DevCon](https://docs.microsoft.com/windows-hardware/drivers/devtest/devcon)ツールを使用して、デバイスをインストールまたは再インストールすることです。 その後、WinDbg を使用して共同インストーラーをデバッグできます。

このタスクを実行するには、次の手順に従います。 この手順では、共同インストーラーを使用するデバイス用の動作中のドライバーのインストールパッケージを開発していることを前提としています。 また、WDK の最新のコピーがあることを前提としています。 ドライバー、ドライバーインストールパッケージ、ドライバーインストールの共同インストーラーの開発の詳細については、WDK のドキュメントを参照してください。

**DevCon と WinDbg を使用した共同インストーラーのデバッグ**

1.  ハードウェアデバイスに接続します。

2.  **新しいハードウェアが見つかりまし**たウィザードをキャンセルします。

3.  WinDbg を開始します。

4.  [WinDbg の**ファイル**] メニューから [**実行可能**ファイルを開く] を選択します。

5.  [**実行可能ファイルを開く**] ダイアログボックスで、次の操作を行います。
    1.  [ファイルの選択] テキストボックスで、[DevCon] ツール (Devcon) を選択します。 そのためには、WDK インストールフォルダーに移動し、サブディレクトリツールを開きます。次に、サブディレクトリ [devcon] を開き、コンピューターのプロセッサアーキテクチャに一致するサブディレクトリを開き、[Devcon] を選択します。 [Devcon] で [1 回のみ] をクリックし、[**開く**] をまだクリックしません。
    2.  [**引数**] テキストボックスに、次のテキストを入力します。ここで、 *inffile*はデバイスのインストール情報 (INF) ファイルのファイル名、 *HARDWAREID*はデバイスのハードウェア ID です。

        ```text
        update INFFile HardwareID 
        ```

    3.  [**ディレクトリの開始**] ボックスに、デバイスのインストールパッケージへのパスを入力します。
    4.  **[開く]** をクリックします。

6.  デバッグプロセスが開始され、WinDbg によってドライバーがインストールされる前に、WinDbg が DevCon プロセスに分割されます。

7.  インストーラープロセスが読み込まれたときに、それを中断するようにデバッガーを構成します。 これを行うには、次のいずれかの方法を使用します。
    -   デバッガーコマンドウィンドウで、 [**sxe (例外の設定)**](sx--sxd--sxe--sxi--sxn--sxr--sx---set-exceptions-.md)コマンドの後に**ld:** を使用し、ファイル拡張子を除く共同インストーラーのファイル名を使用します。 コロンの後にスペースを配置することはできません。たとえば、共同インストーラーの名前が mycoinst の場合は、次のコマンドを使用します。
        ```dbgcmd
        sxe ld:mycoinst 
        ```

    -   WinDbg の [**デバッグ**] メニューから [**イベントフィルター** ] を選択します。 [**イベントフィルター** ] ダイアログボックスで、[**モジュールの読み込み**] を選択します。 [**実行**] で、[有効] を選択し**ます。** [**続行**] で、[処理しない] を選択し**ます。** [**引数**] ボタンをクリックし、テキストボックスに、ファイル拡張子を除いた共同インストーラーのファイル名を入力します (たとえば、「mycoinst」を「mycoinst」と入力します)。 [ **OK]** をクリックし、[**閉じる**] をクリックします。

8.  F5 キーを押すか、デバッガーコマンドウィンドウで**g (enter)** コマンドを入力して、実行を再開します。

9.  共同インストーラーが読み込まれると、実行はデバッガーに戻されます。 この時点で、必要な追加のブレークポイントを設定できます。

### <a name="span-idlimitations_of_this_procedurespanspan-idlimitations_of_this_procedurespanlimitations-of-this-procedure"></a><span id="limitations_of_this_procedure"></span><span id="LIMITATIONS_OF_THIS_PROCEDURE"></span>この手順の制限事項

場合によっては、デバイスインストールパッケージを DevCon で実行すると、セキュリティトークンが異なるため、PnP インストールとは若干異なる動作になることがあります。 共同インストーラーで特定の問題をデバッグする場合は、DevCon が関係していると、この問題がレプリケートされない可能性があります。 このため、この手法を使用する前に、DevCon を使用して、PnP と DevCon の両方のシナリオにこの問題が存在することを確認するデバッガーがアタッチされていない状態でドライバーをインストールする必要があります。

消滅がインストールを開始するときに問題が発生した場合は、DevCon を使用せずに共同インストーラーをデバッグする必要があります。 これを行う1つの方法として、 [tlist.exe](tlist.md)ツールを **/m**オプションと共に使用して、どのプロセスが共同インストーラーモジュールを読み込んでいるかを判断し、そのプロセスにデバッガーをアタッチします。

 

 





