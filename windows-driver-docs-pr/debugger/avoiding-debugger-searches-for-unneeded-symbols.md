---
title: デバッガーによる不要なシンボルの検索の回避
description: シンボルの読み込みに時間がかかることがあるのはなぜですか。 これは、シンボル名が修飾されているかどうかによって異なります。
ms.assetid: 710BAEAF-BC45-416E-8359-69E9DFCA2570
ms.date: 11/28/2017
ms.localizationpriority: medium
ms.openlocfilehash: 6443cb2cc97e0a047bf29d12b349ddc821c0a6c4
ms.sourcegitcommit: dadc9ced1670d667e31eb0cb58d6a622f0f09c46
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 06/09/2020
ms.locfileid: "84533907"
---
# <a name="avoiding-debugger-searches-for-un-needed-symbols"></a>不要なシンボルをデバッガーが検索するのを回避する

**最終更新日時:**

- 2007年5月27日

ドライバーのデバッグ中は興味深いブレークポイントが表示されます。デバッガーは、所有していないドライバーのシンボルの読み込みを試行していて、手動でデバッグタスクを実行する必要はありません。 何が起こっているのでしょうか。

既定では、シンボルは必要に応じてデバッガーによって読み込まれます。 (これは、遅延シンボルの読み込みまたは遅延シンボルの読み込みと呼ばれます)。デバッガーは、シンボルの表示を呼び出すコマンドを実行するたびにシンボルを検索します。 現在のコンテキストで無効になっているウォッチ変数 (現在のスタックフレームに存在しない関数パラメーターやローカル変数など) を設定している場合、これはブレークポイントで発生する可能性があります。これは、コンテキストが変更されたときに無効になるためです。 また、シンボル名を間違えたり、無効なデバッガーコマンドを実行したりした場合にも発生することがあります。デバッガーは、一致するシンボルを探し始めます。

これには時間がかかることがあるのはなぜですか。 これは、シンボル名が修飾されているかどうかによって異なります。 修飾シンボル名の前には、記号を含むモジュールの名前 (たとえば、myModule! myVar) が付けられます。 修飾されていないシンボル名には、モジュール名 (myOtherVar など) が指定されていません。

修飾名の場合、デバッガーは指定されたモジュールでシンボルを検索し、モジュールがまだ読み込まれていない場合はモジュールを読み込みます (モジュールが存在し、シンボルが含まれていることを前提としています)。 これは非常に短時間で行われます。

修飾されていない名前の場合、デバッガーは、どのモジュールにシンボルが含まれているのかを認識しないので、すべてを検索する必要があります。 デバッガーは、まずシンボル用に読み込まれたすべてのモジュールを確認してから、読み込まれたモジュールのシンボルと一致しない場合、すべてのアンロードされたモジュールを読み込みます。ダウンストリームストアから開始し、シンボルサーバーを使用している場合は終了します。 当然ながら、これには時間がかかることがあります。

## <a name="how-to-prevent-automatic-loading-for-unqualified-symbols"></a>非修飾シンボルの自動読み込みを回避する方法

**Symopt \_ NO の \_ 非修飾 \_ 読み込み**オプションは、非修飾シンボルを検索するときに、モジュールの自動読み込みを無効または有効にします。 **Symopt \_ NO の \_ 非修飾 \_ 読み込み**が設定されていて、デバッガーが非修飾シンボルとの一致を試みると、既に読み込まれているモジュールだけが検索され、シンボルと一致しない場合は検索を停止して検索を続行します。 このオプションは、修飾名の検索には影響しません。

**Symopt \_既定では、 \_ 非修飾 \_ 読み込み**は無効になっています。 このオプションを有効にするには、 **-snul**コマンドラインオプションを使用するか、デバッガーの実行中に **. symopt + 0x100**または**symopt-0x100**を使用して、オプションをオンまたはオフにします。

**Symopt の \_ \_ 非修飾 \_ 読み込み**の効果を確認するには、次の実験を試してみてください。

1. **-N**コマンドラインオプションを使用して、ノイズシンボル読み込み (**symopt \_ デバッグ**) をアクティブにします。または、デバッガーが既に実行されている場合は、 **. symopt + 0x80000000**または **! sym 雑音**デバッガー拡張コマンドを使用します。 **Symopt \_デバッグ**は、読み込まれた各モジュールの名前など、シンボルの検索に関する情報を表示するようにデバッガーに指示します。デバッガーがファイルを見つけられない場合は、エラーメッセージを表示します。
2. 存在しないシンボルを評価するようにデバッガーに指示します (たとえば、「 **? asdasdasd**」と入力します)。 デバッガーは、存在しないシンボルを検索している間に多くのエラーを報告する必要があります。
3. Symopt **+ 0x100**を使用して、 **symopt \_ NO の \_ 非修飾 \_ 読み込み**をアクティブにします。
4. 手順 2. を繰り返します。 デバッガーは、読み込まれているモジュールだけが存在しないシンボルを検索する必要があり、タスクの完了にかかる時間が大幅に短縮されます。
5. **Symopt \_ デバッグ**を無効にするには、 **. symopt-0x80000000**または **! sym quiet**デバッガー拡張機能コマンドを使用します。

デバッガーがシンボルを読み込んで使用する方法を制御するためのオプションが多数用意されています。 シンボルオプションとその使用方法の完全な一覧については、Windows 用デバッグツールで提供されるオンラインドキュメントの「シンボルオプションの設定」を参照してください。 Windows パッケージ用デバッグツールの最新リリースは、web から無料でダウンロードできます。また、Windows DDK、Platform SDK、またはカスタマーサポート診断 CD からパッケージをインストールすることもできます。

## <a name="what-should-you-do"></a>対策

- シンボル検索を高速化するには、可能な限り、ブレークポイントとデバッガーコマンドで修飾名を使用します。 既知のモジュールのシンボルを表示する場合は、モジュール名で修飾します。記号がどこにあるかわからない場合は、非修飾名を使用します。 ローカル変数と関数の引数の場合は、 **$** モジュール名としてを使用します (たとえば、 *$!MyVar*)。
- シンボルの読み込み速度の低下の原因を診断するには、 **-n**コマンドラインオプションを使用して、またはデバッガーが既に実行されている場合は、 **. symopt + 0x80000000**または **! sym のノイズ**があるデバッガー拡張コマンドを使用して、ノイズシンボルの読み込み (**symopt \_ DEBUG**) を有効にします。
- デバッガーがアンロードされたモジュール内のシンボルを検索できないようにするには、 **-snul**コマンドラインオプションを使用して、またはデバッガーが既に実行されている場合は、 **. symopt + 0x100**を使用して、非** \_ \_ 修飾 \_ 読み込み**を有効にします。
- デバッグセッションに必要なモジュールを明示的に読み込むには、 **reload**や**ld**などのデバッガーコマンドを使用します。

## <a name="related-topics"></a>関連トピック

[WDK をダウンロードする](https://docs.microsoft.com/windows-hardware/drivers/download-the-wdk)

[Windows 用デバッグ ツールのダウンロード](debugger-download-tools.md)

[Windows のデバッグの概要](getting-started-with-windows-debugging.md)
