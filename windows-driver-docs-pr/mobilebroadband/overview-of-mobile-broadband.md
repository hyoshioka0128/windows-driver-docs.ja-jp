---
title: モバイル ブロードバンドの概要
description: モバイル ブロードバンドの概要
ms.assetid: 5193927b-7367-468e-8012-c41f6bd743a3
ms.date: 04/20/2017
ms.localizationpriority: medium
ms.openlocfilehash: b7a97c825540f7c273b21b842b0b701b8ddd16ed
ms.sourcegitcommit: adccef85b24a37b1caa51e1b3435741a2f022cd5
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 06/12/2020
ms.locfileid: "84724419"
---
# <a name="overview-of-mobile-broadband"></a>モバイル ブロードバンドの概要

Windows 8、Windows 8.1、および Windows 10 では、モバイルネットワークオペレーターの新しい機会を提供しながら、ユーザーのモバイルブロードバンド接続を簡略化します。 ユーザーは、効率的で一貫性のある接続フローを利用できます。 Windows 8、Windows 8.1、Windows 10 では、従来の接続管理アプリを開発する必要性が軽減されます。これにより、アカウント管理や付加価値サービスなど、顧客の操作に関する開発リソースを重視することができます。

Windows 8、Windows 8.1、Windows 10 には、既存のモバイルブロードバンドエコシステムを再想像して合理化する機会があります。

- 以前のバージョンのモバイルブロードバンドハードウェアには、カスタム Windows ドライバーが必要でした。 現在のモバイルブロードバンドクラスドライバーでは、認定されたモバイルブロードバンドデバイスのエクスペリエンスが一貫しており、カスタムドライバーをインストールする必要はありません。 この合理化によって、顧客に "動作する" だけでなく、サポートのオーバーヘッドが減少する可能性があります。

- カスタマイズされた接続管理では、Windows の機能が重複し、他のウィンドウとは異なる UX モデルが用意されています。 これらの接続マネージャーは、オペレーターとその ISV パートナーによって展開および管理される必要があります。

- カスタムドライバーやカスタム接続管理ソフトウェアが必要な場合は、USB ベースのモバイルブロードバンドデバイスでも、カスタムソフトウェアをユーザーの PC に配布するために USB 記憶域機能を実行する必要があります。 このデュアルモードデバイスの概念では、多くの場合、ユーザーがストレージモードとモデムモードを切り替える必要があり、ユーザーがネットワークに正常に接続できるようになる前に追加のタスクを追加する必要があります。

- カスタマーエクスペリエンスを一意にするための独自のサービスと機能を強調します。 Windows 8、Windows 8.1、Windows 10 では、お客様の接続に焦点を当てることができます。また、以前はモバイルオペレーターアプリと呼ばれていた UWP モバイルブロードバンドアプリを通して、独自の価値を強調することができます。

## <a name="key-scenarios"></a>主なシナリオ

このセクションでは、現在のモバイルブロードバンドエクスペリエンスの一部である主要なシナリオについて説明します。これは、有効にすることを選択できます。 アプリがどの Windows コンポーネントと対話する必要があるかを計画するときは、ビジネスモデルのコンテキストでこれらの各シナリオを検討してください。

- [購入の計画](#plan-purchase)

- [アクティブなデバイスの接続](#connecting-an-active-device)

- [オペレーター通知とシステムイベント](#operator-notifications-and-system-events)

- [正確な使用状況データとプランデータを提供する](#providing-accurate-usage-and-plan-data)

- [インターネット共有](#internet-sharing)

- [Wi-fi ホットスポット認証](#wi-fi-hotspot-authentication)

- [ユーザーへのアカウント情報の表示](#displaying-account-information-to-the-user)

- [その他のデバイスとアプリのシナリオを有効にする](#enabling-other-devices-and-app-scenarios)

### <a name="plan-purchase"></a>購入を計画する

シームレスなプラン購入エクスペリエンスを使用すると、ユーザーは接続を簡単に購入でき、オペレーターはサポートや小売店の介入を必要とせずに新しい顧客を受け入れることができます。 購入プランには、次の2つのオプションがあります。

- モバイルブロードバンドアプリとサービスメタデータは、既に PC にインストールされています。 これは、OEM がモバイルブロードバンドアプリとサービスメタデータを Windows イメージに事前に読み込んでいる、または代替のインターネット接続が利用可能な、モバイルブロードバンドハードウェアが組み込まれている Pc で発生する可能性があります。

- モバイルブロードバンドアプリとサービスメタデータが PC にインストールされていません。 これは、ハードウェアドングルを使用していて、代替インターネット接続が利用できない場合に発生する可能性があります。

プランの購入オプションに関係なく、SIM または CDMA モバイルブロードバンドデバイスの状態に基づいて、さまざまなサブ状態があります。 コールド SIMs (関連付けられていないプラン)、ウォーム SIMs (プランを受け入れる準備ができています)、およびホット SIMs (プランで既にアクティブになっている) では、多くの場合、購入フローをどのように構成するかに基づいて異なるエクスペリエンスが提供されます。

### <a name="mobile-broadband-app-is-already-installed-or-an-alternate-internet-connection-is-available"></a>モバイルブロードバンドアプリが既にインストールされているか、別のインターネット接続が使用可能です

この場合、ユーザーがサービスをアクティブ化しようとする前に、埋め込みデバイス、モバイルブロードバンドアプリ、およびサービスメタデータが SIM を使用して既に PC にインストールされていることがあります。 もう1つの可能性は、ユーザーがまだモバイルブロードバンドアプリを持っていないものの、アプリをダウンロードするための代替インターネット接続があることです。 SIM が挿入されると、次の手順が自動的に実行されます。

1. モバイルブロードバンドサービスは、海外のモバイル加入者 Id (IMSI)、GSM ネットワークの統合回線カード ID (ICCID)、CDMA ネットワークのプロバイダー ID (SID)、または CDMA ネットワークのプロバイダー名を読み取り、一連のハードウェア Id (HWIDs) を生成します。

    **メモ**   この手順は、OEM が SIM を挿入せず、モバイルブロードバンドアプリとサービスメタデータをプリロードしている場合にのみ必要です。

2. PC がインターネットに接続されている場合、HWIDs は Windows メタデータとインターネットサービス (WMIS) に送信されます。 WMIS は演算子を識別し、適切なサービスメタデータパッケージを返します。

    **メモ**   この手順は、OEM が SIM を挿入せず、モバイルブロードバンドアプリとサービスメタデータをプリロードしている場合にのみ必要です。

3. Windows は、サービスメタデータを使用して、Microsoft Store からモバイルブロードバンドアプリを識別し、取得します。 アプリは自動的にインストールされます。 Windows 8.1 と Windows 10 では、アプリはスタート画面にピン留めされません。

    **メモ**   この手順は、OEM が SIM を挿入せず、モバイルブロードバンドアプリとサービスメタデータをプリロードしている場合にのみ必要です。

4. オペレータのロゴと名前は、Windows 接続マネージャーの [ネットワーク] の一覧に表示されます。 ユーザーは、ネットワークに接続できます。

5. Windows 接続マネージャーは、サービスメタデータのネットワークプロファイル構成情報を使用して接続を試みます。 次の手順は、接続の結果によって異なります。

    - 最初の接続が成功し、インターネット接続が利用可能な場合は、それ以上の処理は行われません。 ユーザーは以前にサービスを購入し、アクティブなアカウントを持っています。

    - 最初の接続が成功しても、インターネット接続が利用できない場合は、モバイルブロードバンドアプリが起動し、ユーザーは購入プランを要求されます。

    - 最初の接続に失敗した場合、ネットワークサービスがまだ購入されていないことを示すエラーコードは、モバイルブロードバンドアプリを開始したことを示します。 アプリは適切な応答を判断できます。 たとえば、エラーコードが接続されていないことが原因である場合は、電話による購入を完了するか、別のインターネット接続に接続することによって、ユーザーに指示を送ることが必要になる場合があります。

    - 最初の接続が別のエラーコードで失敗した場合、Windows 接続マネージャーは、エラーについてユーザーに通知します。 モバイルブロードバンドアプリが開始されていません。

6. モバイルブロードバンドアプリを開いたときに、ユーザーがサブスクリプションを購入できるように、バックエンドの課金インフラストラクチャへのセキュリティで保護された接続を行うようにアプリが作成されていることを確認する必要があります。 このプロセスはオペレーターごとに所有されており、Microsoft は購入プロセスには関与しません。 アプリは、制限付きのモバイルブロードバンド接続 (オペレータネットワークで有効にする必要がある) または別のインターネット接続 (Wi-fi など) を介してこの接続を確立します。

7. プランの購入が完了すると、モバイルブロードバンドアプリによって、プロビジョニングエージェントに渡されるメタデータプロビジョニングファイルが生成されます。 これにより、ユーザーが購入したプランに関する情報を使用して Windows が構成されます。

**重要**   上記の手順は、代替のインターネット接続を使用して PC に接続されている外部デバイスにも当てはまります。

### <a name="mobile-broadband-app-is-not-installed-and-no-alternate-internet-connection-is-available"></a>モバイルブロードバンドアプリがインストールされていないため、代替インターネット接続が利用できません

ハードウェアドングルなどの外部モバイルブロードバンドデバイスは、代替のインターネット接続がない可能性があり、モバイルブロードバンドアプリがインストールされていない可能性のある Pc に挿入できます。 次の手順では、このシナリオでの制限を回避するためにプラン購入エクスペリエンスを構築する方法について説明します。

1. モバイルブロードバンドハードウェアが検出されるとすぐに、Windows Mobile ブロードバンドサービスは、IMSI、ICCID、プロバイダー ID、またはプロバイダー名を読み取り、デバイスから読み取られた各値を表す HWIDs のセットを生成します。 Windows Mobile ブロードバンドサービスは、モバイルブロードバンド関連のイベントをリッスンします。

2. ユーザーが [**接続**] をクリックすると、次のように、HWID 値を使用して Windows APN データベースの接続設定が特定されます。

    - 最初の接続が成功し、インターネット接続が利用可能な場合は、それ以上の処理は行われません。 ユーザーは以前にサービスを購入し、アクティブなアカウントを持っています。

    - 最初の接続が成功しても、インターネット接続が利用できない場合、ユーザーは、この HWID の範囲の APN データベースで指定されている URL に移動します。

    - 最初の接続に失敗した場合、Windows 接続マネージャーは、エラーについてユーザーに通知します。 Web サイトは、ユーザーがプランを購入するのを支援します。

3. プランの購入が完了すると、web サイトによってメタデータ準備ファイルが生成され、プロビジョニングエージェントに渡されます。 これにより、ユーザーが購入したプランに関する基本的な情報を使用して Windows が構成されます。 ネットワーク構造によっては、次のいずれかが発生します。

    - 現在の接続では、ユーザーにインターネットアクセスが許可されます。

    - プロビジョニングファイルには、同じネットワークまたは別のネットワークに接続を切断して再接続するための手順が含まれています。これにより、インターネットアクセスが提供されます。

    この時点で、ユーザーはオンラインです。 インターネット接続が利用可能になったので、Windows はモバイルブロードバンドハードウェアを検出し、サービスメタデータとモバイルブロードバンドアプリをダウンロードしてインストールします。

4. SIM またはモバイルブロードバンドデバイスから計算された HWIDs は、WMIS に送信されます。 WMIS は演算子を識別し、適切なサービスメタデータパッケージを返します。

5. Windows は、サービスメタデータを使用して、関連付けられているモバイルブロードバンドアプリを Microsoft Store から特定し、取得します。 アプリは自動的にインストールされ、バックグラウンドイベント用に登録されます。 Windows 8.1 と Windows 10 では、アプリはスタート画面に自動的にピン留めされません。 バックグラウンドイベントに登録すると、アプリケーションはローカルデータ使用量カウンターへの応答、オペレーターの SMS メッセージの受信、Wi-fi ホットスポットへの接続、権利チェックの処理などを行うことができます。

6. バックグラウンドイベントが発生すると、必要に応じて、アプリでより完全なプロビジョニングファイルが生成され、プロビジョニングエージェントに渡されます。 これにより、ユーザーが購入したプランに関する情報を使用して Windows が構成されます。

### <a name="connecting-an-active-device"></a>アクティブなデバイスの接続

アクティブなモバイルブロードバンドプランを使用しているデバイスが PC に接続されている場合、接続しようとするとインターネットに接続している点を除いて、このエクスペリエンスは購入の場合と似ています。 Windows では、モバイルブロードバンド用のモバイルブロードバンドアプリを起動したり、携帯電話会社の web サイトに接続したりすることはありません。 代わりに、アプリがバックグラウンドでインストールされます。

1. モバイルブロードバンドハードウェアが検出されると、モバイルブロードバンドサービスは、IMSI、ICCID、プロバイダー ID、またはプロバイダー名を読み取り、HWIDs を生成します。

2. ユーザーが [**接続**] をクリックすると、HWID の値が Windows APN データベース内の適切な接続設定を見つけるために使用されます。 アクティブなデバイスの場合、接続は成功し、インターネット接続が可能です。

3. この時点で、ユーザーはオンラインです。 インターネット接続が利用できるようになったので、Windows はモバイルブロードバンドハードウェアを検出し、サービスメタデータとモバイルブロードバンドアプリをダウンロードしてインストールします。

アクティブなプランのモバイルブロードバンドデバイスが PC に接続されている場合、Windows セットアップ中に Windows 8.1 と Windows 10 はオペレーターネットワークに接続できます。 モバイルブロードバンドネットワークは、Windows セットアップ中に Wi-fi ネットワークと共に [ネットワーク] の一覧に表示されます。 アクティブなデバイスを接続するプロセスと同様に、HWID は検出されたモバイルブロードバンドハードウェアに基づいて生成され、Windows APN データベース内の適切な接続設定を見つけるために使用されます。

### <a name="operator-notifications-and-system-events"></a>オペレーター通知とシステムイベント

ユーザーがアカウントの状態に関する通知を受け取るには、ユーザーが操作していない場合でも、モバイルブロードバンドアプリでいくつかのアクティビティを実行する必要があります。 これらのアクティビティには、オペレーター SMS またはネットワークで開始された USSD メッセージへの応答、データの上限に近づいていることをユーザーに通知する、データプランの有効期限が切れたことをユーザーに通知する、ユーザーにローミングステータスを通知するなどが含まれます。 受信 SMS メッセージは、サービスメタデータパッケージによって PC の SMS 機能へのアクセスが許可されている特権アプリで利用できます。

一部の SMS メッセージは、モバイルネットワークオペレーターから直接取得され、モバイルブロードバンドアプリを使用してユーザーに表示する必要があります。 モバイルブロードバンドアプリは、オペレーターの SMS メッセージを受信したときにトースト通知を呼び出すことができます。

エンドユーザーに表示されることを意図していないオペレーターメッセージについては、モバイルブロードバンドアプリでそれらを処理し、適切に動作させることができます。 Windows Notification Service は、最も効率的なアプリ内通知チャネルを提供しますが、Windows では、モバイルブロードバンドネットワークからの受信 SMS および非構造化補助サービスデータ (USSD) 通知の使用もサポートしています。

SMS メッセージの処理の詳細については、「 [sms アプリの開発](developing-sms-apps.md)」を参照してください。 オペレーター通知の詳細については[、「モバイルオペレーター通知とシステムイベントの有効化](enabling-mobile-operator-notifications-and-system-events.md)」を参照してください。

1. サービスメタデータは、モバイルブロードバンドアプリがオペレーターの通知にアクセスすることを宣言します。 プライベートバックグラウンドイベントが作成され、アプリがインストールされた時点でオペレーター通知イベントに登録されます。

2. アプリがプロビジョニングメタデータを適用すると、オペレーターメッセージと見なす必要があるすべての SMS メッセージと USSD メッセージの説明が含まれます。

SMS または USSD メッセージを受信すると、モバイルブロードバンドサービスは、プロビジョニングメタデータで指定された説明とメッセージを比較します。 解析規則が含まれている場合、モバイルブロードバンドサービスもメッセージを解釈し、データの使用状況に関する情報を更新します。

メッセージが一致する場合、システムイベントブローカーには、そのモバイルブロードバンドアプリのプライベートなバックグラウンドイベントを呼び出すように通知されます。 それ以外の場合、システムイベントブローカーには、パブリック SMS イベントを呼び出すように通知されます。

受信 SMS メッセージに応答するためにオペレーターがモバイルブロードバンドアプリに含めることのできる例には、次のようなものがあります。

- 現在のデータ使用状況を直ちに同期しています

- ユーザーへの通知の表示

- アプリのライブタイルを更新しています

- 更新されたプロビジョニングメタデータの取得と適用

**メモ**   Windows 8、Windows 8.1、および Windows 10 には、オペレーティングシステムに SMS アプリが含まれていないため、ユーザーに SMS メッセージを表示するには、オペレーターが特権アクセスを付与するモバイルブロードバンドアプリまたはサードパーティ製の SMS アプリが必要です。

 **メモ**   SMS サポートを使用したモバイルブロードバンドアプリの構築は、テキストメッセージを受信するときにエンドユーザーに通知 UI を表示するために必要です。これは、特定の市場における規制要件やベストプラクティスに準拠するために必要な場合があります。

 SMS 機能は、モバイルブロードバンドアプリ、モバイルネットワークオペレーターへの特権アクセスを付与された UWP アプリ、PC OEM によって特権アクセスが付与された UWP アプリ (モバイルブロードバンドデバイスが PC に埋め込まれている場合)、またはモバイルブロードバンドデバイス IHV (モバイルブロードバンドデバイスがリムーバブルの場合) で使用できます。 モバイルネットワークオペレーターと PC OEM (またはモバイルブロードバンドデバイス IHV) は、サービスメタデータを通じて特権アプリを指定します。 サービスメタデータの詳細については、「[メタデータを使用してモバイルブロードバンドエクスペリエンスを構成する](using-metadata-to-configure-mobile-broadband-experiences.md)」を参照してください。

### <a name="providing-accurate-usage-and-plan-data"></a>正確な使用状況データとプランデータを提供する

Windows には、モバイルブロードバンドアプリがユーザーのデータプランを説明するために使用できるデータ使用とサブスクリプションマネージャー Api が用意されています。 モバイルブロードバンドアプリでは、この API を、データプランのサイズ、従量制課金プラン、および従量制以外のプランに関する情報と、オペレーターのネットワークから更新されたデータ使用状況の値によって更新できます。

Windows は、これらの Api を使用してユーザーに設定されているデータ使用状況情報を確認し、コア機能の動作を変更します。 たとえば、Windows Update は、ユーザーが従量制課金ネットワークを使用している場合にのみ、重要な更新プログラムを自動ダウンロードします。 使用状況情報は、データ使用量とサブスクリプションマネージャー Api を使用して、サードパーティ製アプリにもアクセスできます。

次に示すのは、ユーザーがデータの使用状況を通知するために、モバイルブロードバンドアプリが使用できるさまざまな機能のチュートリアルです。

1. ローカルデータカウンターは、プロファイルの使用状況が、オペレーターからの最後の更新以降にユーザーのデータ制限の5% を超えて変更されたことを推定します。 この5% のインクリメントはハードコーディングされており、モバイルブロードバンドアプリはバックグラウンドイベントを使用してスリープ状態を解除し、5% の増分に対応できます。

2. データの使用状況とサブスクリプションマネージャーは、この5% の使用量インクリメントの追跡を行う Windows コンポーネントです。 システムイベントブローカーに対して、ローカルの推定使用量の5% 増加ごとにバックグラウンドイベントをトリガーするように通知します。

3. システムイベントブローカーは、バックグラウンドイベントを処理するために、モバイルブロードバンドアプリを呼び出します。 (受信通知などの他のトリガーによって、この問題が発生する可能性があります)。モバイルブロードバンドアプリは、この目的で呼び出されたときの動作を選択できます。

4. ベストプラクティスとして、アプリでは、オペレーターの請求インフラストラクチャから最新の使用状況情報を取得して、ユーザーが実際に使用した使用量を検証することで、このイベントを処理することをお勧めします。 これは、ネットワーク経由の非同期操作であり、モバイルブロードバンドアプリがオペレーターの請求インフラストラクチャからこの情報を取得する際の遅延に反応できる必要があります。 データ使用状況の追跡に大きな遅延が発生した場合、モバイルブロードバンドアプリはローカルデータカウンターに対してクエリを実行し、現在の時刻と最新のデータとの間のギャップを埋めることができます。

5. オペレーターの請求インフラストラクチャに対する web クエリが完了すると、モバイルブロードバンドアプリは、Windows に返される最新の使用状況情報を記述する更新されたプロビジョニングメタデータを適用できます。

6. アプリは、データ使用量とサブスクリプションマネージャー Api を使用して、更新された情報を公開します。

7. PC 上の windows コンポーネントとサードパーティのアプリは、 [**windows の接続プロファイル**](https://docs.microsoft.com/uwp/api/Windows.Networking.Connectivity.ConnectionProfile)クラスを使用して、この使用状況情報にアクセスできます。 アプリは、それに応じて動作を調整できます。 たとえば、アプリでは、従量制課金ネットワークで低品質のビデオストリームを使用できます。

### <a name="internet-sharing"></a>インターネット共有

モバイルブロードバンドは、ユーザーがどこにいても接続できるようにします。 ただし、すべてのデバイスにモバイルブロードバンドデバイスが搭載されているわけではありません。 Windows 8.1 と Windows 10 を使用すると、ユーザーは、さまざまなデバイスを使用して、友人や家族との Wi-fi でモバイルブロードバンド接続を共有できます。

ユーザーは、[PC 設定] でインターネット共有を有効にすることができます。 また、SSID、Wi-fi ネットワークのパスワード、および接続を共有しているユーザー数を変更することもできます。

モバイルブロードバンド接続を別のデバイスで使用する場合、Windows ではさらに簡単に行うことができます。 Windows 8.1 または Windows 10 を実行している WiFi 対応 PC のネットワークリストを開くだけで、共有デバイスの SSID をクリックし、[**接続**] をクリックします。 Windows は、すべてのデバイス構成とデバイス間通信を処理します。

次に、Windows 8.1 と Windows 10 でのインターネット共有の動作を構成および管理するためのさまざまな機能のチュートリアルを示します。

1. PC に自動的にダウンロードされてインストールされるサービスメタデータパッケージをアップロードすることで、お客様がインターネット共有を使用できるかどうかを選択できます。

2. サービスメタデータを使用して、モバイルブロードバンドアプリでサービスに対する権利チェックを実行するかどうかを選択して、特定の顧客がテザリングをサポートするデータプランを購入したかどうかを確認することもできます。

3. モバイルブロードバンドアプリは、ユーザーがインターネット共有を有効にし、許可するかどうかを Windows に指示するたびに権利チェックを実行するために、バックグラウンドイベントを登録します。

4. プロビジョニングメタデータの一部として、共有データトラフィックに使用する PDP コンテキストと APN、および一度に接続を共有できるデバイスの最大数を指定できます。

5. 更新されたローカルデータ使用量 Api を使用して、モバイルブロードバンドアプリでエクスペリエンスを作成し、モバイルブロードバンド接続を共有している他のデバイスで使用されたデータの量を表示できます。

インターネット共有の詳細については、「[インターネット共有エクスペリエンスの作成と構成](creating-and-configuring-internet-sharing-experiences.md)」を参照してください。

### <a name="wi-fi-hotspot-authentication"></a>Wi-fi ホットスポット認証

モバイルブロードバンドアプリでは、プロビジョニングメタデータの一部として、ユーザーがオペレーターが指定した資格情報を使用して認証できるホットスポットを記述できます。 これには、eap-sim、EAP、またはその他のサポートされている EAP メソッドを使用して、WISPr 1.0 のホットスポットや暗号化されたホットスポットが含まれる場合があります。

その後、Windows は、範囲内でこれらのホットスポットにデータトラフィックを自動的にオフロードします。 携帯データネットワークからのネットワークトラフィックを、地上線ベースの Wi-fi の場所にオフロードするために、この操作を行うことができます。 場合によっては、Wi-fi ホットスポットが、その場所の携帯データネットワークよりも速度が向上したり、カバレッジが向上したりすることがあります。

また、モバイルネットワークより優先度の低いホットスポットを作成することもできます。これにより、モバイルブロードバンド接続を使用できず、データオフロードに使用しない場合に、Windows で使用できるようになります。

### <a name="setup"></a>セットアップ

- モバイルブロードバンドアプリでは、ユーザーが認証できる WiFi ホットスポットの Ssid と認証メカニズムを含むプロビジョニングファイルが生成されます。 これにより、ユーザーがこの情報を手動で入力する必要がなくなります。

- プロビジョニングエージェントは、プロビジョニングファイルを解析し、Windows 接続マネージャーに必要な情報を提供します。 Windows は、使用可能な場合、これらのネットワークに自動的に接続します。

### <a name="credential-generation"></a>資格情報の生成

モバイルブロードバンドアプリが接続中に専用の方法で WISPr 資格情報を生成または取得する場合、プロビジョニングメタデータには、特定の資格情報を提供するのではなく、アプリへの参照が含まれます。 特定の資格情報が含まれている場合、このフェーズはスキップされます。

1. Wi-fi ホットスポット内の専用ポータル web サイトには、ワイヤレスインターネットサービスプロバイダーローミング (WISPr) プロトコルからの課題が含まれています。

2. 静的な資格情報が指定されていない場合、Windows 接続マネージャーは、ホットスポット認証が行われていることをシステムイベントブローカーに通知します。 それ以外の場合、Windows 接続マネージャーは認証に直接進みます。

3. 独自の認証方式の場合、システムイベントブローカーは、モバイルブロードバンドアプリを呼び出して資格情報を生成します。

4. アプリは、独自のメカニズムを使用して資格情報を生成します。 これらの情報は、ネットワークリソース、またはモバイルブロードバンドインターフェイスとの相互作用を伴う場合と、ない場合があります。 最終的に、アプリは次のいずれかのアクションを実行します。

    - **資格情報を入力**します。アプリはこのネットワークの資格情報を生成し、Windows 接続マネージャーに返すことができます。 Windows 接続マネージャーは、WISPr を使用してホットスポットに対する認証を行います。

    - **接続を取り消し**ます。 PC はこのネットワークに接続できません。 Windows 接続マネージャーが接続を終了します。

    - **認証のキャンセル**--アプリは別の方法を使用して認証されています。 Windows 接続マネージャーは、認証も切断も行いません。

    - **ユーザーと対話**する-アプリは前景に移動します。 これは、ユーザーの確認が必要なときに選択します。たとえば、接続ごとのホットスポットを選択します。 アプリは、ユーザーをコンサルティングした後に、前述のいずれかのアクションを実行する必要があります。

### <a name="authentication"></a>認証

モバイルブロードバンドアプリ (動的 WISPr 資格情報) によって資格情報が提供された場合、またはプロビジョニングの一部として静的に定義されている場合 (静的な WISPr 資格情報、EAP 資格情報)、Windows はこれらの資格情報を Wi-fi ホットスポットに配信します。

モバイルブロードバンドアプリによって Windows 接続マネージャーの接続プロファイルに提供される構成情報によって、資格情報の取得方法と配信方法が決まります。 配信については、次の手順で説明します。

1. ユーザーが Wi-fi ホットスポットの範囲内にある場合、Windows 接続マネージャーは、プロビジョニングメタデータを使用して静的に定義された資格情報で応答します。 このデータは、モバイルブロードバンドアプリ、または信頼された web サイトから生成できます。

2. Wi-fi ホットスポットはオペレーターによって資格情報を検証し、PC がインターネットにアクセスすることを許可します。

### <a name="displaying-account-information-to-the-user"></a>ユーザーへのアカウント情報の表示

Windows 8、Windows 8.1、および Windows 10 でサブスクライバーと対話するための最適な方法は、モバイルブロードバンドアプリを使用することです。 このアプリは、サブスクライバーとの対話に関する主なシナリオを満たすために開発者によって開発されます。

1. PC でモバイルブロードバンドデバイスが検出されると、Windows によって、サブスクライバーが属する MNO または MVNO が決まります。 オペレーターのサービスメタデータは、WMIS によって照合およびダウンロードされます。

2. サービスメタデータは、モバイルブロードバンドアプリを Windows 接続マネージャーの対応するネットワークエントリにリンクします。

3. Windows 接続マネージャーには、オペレーターのロゴ、オペレーター名、および **[アカウントの表示**] リンクが表示されます。

4. ユーザーがリンクをクリックすると、モバイルブロードバンドアプリが開かれます。 アプリを開発して、課金システムから入手可能な最新の情報を取得することができます。

5. 必要に応じて、アプリケーションは、課金システムが最後に更新されてから、ローカルデータカウンターで使用量の見積もりを照会できます。 アプリはこのデータを使用して、ユーザーの使用状況をほぼリアルタイムで表示できます。

6. モバイルブロードバンドアプリには、より多くのシナリオを開発できます。 モバイルブロードバンドアプリで有効にできる主要なシナリオの例とユーザーエクスペリエンスガイドラインの詳細については、「[モバイルブロードバンドアプリのユーザーエクスペリエンスの設計](designing-the-user-experience-of-a-mobile-broadband-app.md)」を参照してください。

### <a name="enabling-other-devices-and-app-scenarios"></a>その他のデバイスとアプリのシナリオを有効にする

Windows 8、Windows 8.1、および Windows 10 は、豊富な開発ツールと柔軟な開発プラットフォームを提供しています。これは、独自の価値を持つ追加のサービスを強調するアプリを作成することによって利用できます。

### <a name="privileged-apps"></a>特権アプリ

モバイルブロードバンド Api と、アカウントのプロビジョニングや SMS などのインターフェイスは、モバイルブロードバンドアプリに限定されています。 これらの特権を持つ Api にアクセスできる特権のあるアプリの一覧は、Windows デベロッパーセンターのダッシュボードに送信されるサービスメタデータパッケージで宣言する必要があります。

### <a name="multiple-pdp-contexts"></a>複数の PDP コンテキスト

Windows 8.1 と Windows 10 では、複数の PDP コンテキストが同時にアクティブになることがサポートされています。 これにより、携帯電話事業者は、差別化されたシナリオを顧客に提供できます。 複数の PDP コンテキストを使用して有効になるシナリオの詳細については、「[複数の pdp コンテキストを使用したアプリの開発](developing-apps-using-multiple-pdp-contexts.md)」を参照してください。

### <a name="wireline-operators"></a>Wireline 演算子

PnP-X を使用して、モバイル以外のブロードバンドデバイスを UWP デバイスアプリとして公開することができます。

DVRs、ゲートウェイルーター、モバイルホットスポット、電話などのデバイスは、windows 8、Windows 8.1、または Windows 10 PC と同じ Wi-fi または LAN ネットワークに接続しているときに、PnP-X を使用して、Windows 8、Windows 8.1、および windows 10 の存在を認識させることができます。 デバイスのプロパティに基づいてデバイスのメタデータがダウンロードされ、ユーザーが開発した UWP デバイスアプリが自動的にダウンロードされます。 これらのデバイスに対してこのアプリを参照できます。これにより、1つのモバイルブロードバンドアプリで、モバイルブロードバンドとこれらの追加デバイスを管理できるようになります。

## <a name="how-it-works"></a>しくみ

このセクションでは、Windows 8、Windows 8.1、および Windows 10 でのモバイルブロードバンドの主なシナリオをサポートするコンポーネントについて説明します。 これらは、Windows オペレーティングシステムの一部であるものと、サービスメタデータまたはモバイルブロードバンドアプリの一部であるものとで分けられています。

![オペレーターエクスペリエンスを提供するためのコンポーネント](images/mb-overviewtechnicalcomponents.jpg)

### <a name="windows-components"></a>Windows コンポーネント

次のコンポーネントは、Windows 8、Windows 8.1、および Windows 10 に含まれています。

- [プロビジョニングエージェント](#provisioning-agent)

- [データ使用量とサブスクリプションマネージャー](#data-usage-and-subscription-manager)

- [Windows 接続マネージャー](#windows-connection-manager)

- [ローカルデータカウンター](#local-data-counters)

- [モバイルブロードバンドサービス](#mobile-broadband-service)

- [モバイルブロードバンドクラスドライバー](#mobile-broadband-class-driver)

- [システムイベントブローカー](#system-event-broker)

- [Windows メタデータとインターネット サービス](#windows-metadata-and-internet-services)

- [Microsoft Store](#microsoft-store)

### <a name="provisioning-agent"></a>プロビジョニングエージェント

プロビジョニングエージェントには、ネットワーク設定を使用して Windows を構成するためのインターフェイスが用意されています。 プロビジョニングエージェントは、必要な構成を記述した XML ファイルを受け入れます。

XML ファイルは、次のいずれかの方法で指定できます。

- Internet Explorer 10 以降 (または他のサポートブラウザー) を実行している Windows 8、Windows 8.1、または Windows 10 コンピューター上の[**msProvisionNetworks**](https://docs.microsoft.com/previous-versions/windows/internet-explorer/ie-developer/platform-apis/dn529170(v=vs.85))関数に、web サイトによって提供される署名付き XML ファイル。

- アプリによって[**ProvisionFromXmlDocumentAsync**](https://docs.microsoft.com/uwp/api/windows.networking.networkoperators.provisioningagent.provisionfromxmldocumentasync?view=winrt-19041#Windows_Networking_NetworkOperators_ProvisioningAgent_ProvisionFromXmlDocumentAsync_System_String_)関数に渡される XML ファイル (署名または署名されていない)。

プロビジョニングファイルの形式と内容の詳細については、「[メタデータを使用してモバイルブロードバンドエクスペリエンスを構成する](using-metadata-to-configure-mobile-broadband-experiences.md)」を参照してください。

### <a name="data-usage-and-subscription-manager"></a>データ使用量とサブスクリプションマネージャー

データ使用量とサブスクリプションマネージャーは、ユーザーのアカウントの詳細を追跡します。 現在接続されているネットワークに関する格納済みコスト情報は、すべての UWP アプリで利用できます。 この情報は、プロビジョニングエージェントを使用して更新できます。

通信事業者が要求した場合、データの使用状況とサブスクリプションマネージャーは、データの上限の5% が使用されているときに、ローカルデータカウンターを使用してバックグラウンドイベントをトリガーします。 システムイベントブローカーはこのバックグラウンドイベントを配信し、モバイルブロードバンドアプリはイベントをトリガーとして使用して、課金対象の使用状況を更新できます。

### <a name="windows-connection-manager"></a>Windows 接続マネージャー

Windows 接続マネージャーは、Wi-fi、モバイルブロードバンド、およびイーサネット全体で利用可能なネットワークを監視します。 これにより、使用可能なネットワークに基づいて、自動接続と切断の決定が行われます。 プロビジョニングエージェントを使用すると、所有するネットワーク間の相対的な優先順位を定義できます。 ただし、ユーザーは任意のネットワークに手動で接続できます。 Windows 接続マネージャーは、ユーザーの手動アクションを使用して、今後の自動接続の選択に影響を及ぼします。

Windows 接続マネージャーは、WISPr 1.0 をサポートする Wi-fi ホットスポットを使用した接続後の認証も管理します。 Wi-fi ホットスポット用に静的資格情報が保存されている場合は、Windows 接続マネージャーが自動的に認証されます。 動的な資格情報が必要な場合は、Windows 接続マネージャーによって、システムイベントブローカーを使用してバックグラウンドイベントがトリガーされます。 その後、モバイルブロードバンドアプリは、適切な資格情報を生成し、認証プロセスを完了するために Windows 接続マネージャーに配布する必要があります。 詳細については、「 [Windows とワイヤレスホットスポットの統合](integrating-windows-with-wireless-hotspots.md)」を参照してください。

### <a name="local-data-counters"></a>ローカルデータカウンター

ローカルデータカウンターは、ネットワークインターフェイス上で送受信されるデータの量を時系列で追跡します。 この情報は、ユーザーに複数の場所で表示されます。

- タスクマネージャーの [**アプリの履歴**] タブ

- オプションWi-fi またはモバイルブロードバンドネットワークの展開されたビューの Windows 接続マネージャー。 ユーザーは、特定のネットワークのこの見積もりを表示するか非表示にするかを決定できます。 既定では、モバイルブロードバンドネットワーク用に表示され、Wi-fi ネットワーク用に非表示になっています。 ただし、モバイルブロードバンドデバイスがインストールされていることが Windows によって検出された場合は、対応するモバイルブロードバンドネットワークの Windows 接続マネージャーでの推定データ使用量が非表示になります。 これは、モバイルブロードバンドアプリを作成した場合に、ユーザーに表示されるデータ使用量の値を制御することを前提としているためです。 これは、モバイルブロードバンドアプリ内で実行することをお勧めします。 ユーザーは、この動作を上書きし、ネットワークの推定使用量をいつでも表示することを選択できます。

ローカルデータカウンターは、次の Api を使用してプログラムで使用することもできます。

- [**GetNetworkUsageAsync**](https://docs.microsoft.com/uwp/api/windows.networking.connectivity.connectionprofile.getattributednetworkusageasync?view=winrt-19041#Windows_Networking_Connectivity_ConnectionProfile_GetAttributedNetworkUsageAsync_Windows_Foundation_DateTime_Windows_Foundation_DateTime_Windows_Networking_Connectivity_NetworkUsageStates_)関数は、指定された期間にわたってデータ使用量を提供します。

- [**GetConnectivityIntervalsAsync**](https://docs.microsoft.com/uwp/api/windows.networking.connectivity.connectionprofile.getconnectivityintervalsasync?view=winrt-19041#Windows_Networking_Connectivity_ConnectionProfile_GetConnectivityIntervalsAsync_Windows_Foundation_DateTime_Windows_Foundation_DateTime_Windows_Networking_Connectivity_NetworkUsageStates_)関数は、ネットワークインターフェイスが使用されている場合に、接続のタイムスタンプと期間を提供します。

ローカルデータの使用状況情報は、ユーザーのための見積もりおよびガイドとして機能します。 Windows では、未請求トラフィックや、同じデータ制限を共有する他のデバイスでの使用を考慮することはできません。 たとえば、家族は異なるデバイスで同じ SIM を使用しています。 モバイルブロードバンドアプリでは、前回の課金システムとの同期以降に使用されたおおよその使用量に対してのみローカルデータカウンターを使用する必要があります。 既に処理されているデータの使用については、課金システムを権限のあるものと見なす必要があります。

### <a name="mobile-broadband-service"></a>モバイルブロードバンドサービス

モバイルブロードバンドサービスは、モバイルブロードバンド Api とモバイルブロードバンドデバイス間の通信を管理する Windows サービスです。 このサービスは、ドライバーが Windows Mobile ブロードバンドドライバーモデルに準拠しているすべてのモバイルブロードバンドデバイスと対話できます。

また、新しく挿入されたデバイスの SIM を読み取り、接続されているモバイルブロードバンドデバイスに対応するサービスメタデータとモバイルブロードバンドアプリを取得するプロセスを開始します。

### <a name="mobile-broadband-class-driver"></a>モバイルブロードバンドクラスドライバー

モバイルブロードバンドクラスドライバーを使用すると、デバイスの製造元が特定のモバイルブロードバンドデバイス用のカスタムドライバーを提供する負担が軽減されます。 Usb デバイスとして動作し、usb 実装者フォーラム (USB IF) ネットワーク制御モデル (NCM) 2.0 仕様に準拠しているモバイルブロードバンドインターフェイスは、モバイルブロードバンドクラスドライバーによって管理され、追加のドライバーをダウンロードまたはインストールする必要はありません。

モバイルブロードバンドクラスドライバーは、Windows Mobile ブロードバンドドライバーモデルに準拠しており、モバイルブロードバンドサービスに完全な機能を提供します。 また、モバイルブロードバンドアプリに直接公開されるカスタム拡張機能もサポートしています。 詳細については、「[携帯電話会社のハードウェアの概要](mobile-operator-hardware-overview.md)」を参照してください。

### <a name="system-event-broker"></a>システムイベントブローカー

システムイベントブローカーは、バックグラウンドイベントを管理します。 モバイルブロードバンドアプリを含むアプリは、システム状態の変化に対応するために、を登録してバックグラウンドイベントを受信できます。 モバイルブロードバンドアプリにとって、次のようなイベントが発生する可能性があります。

- ネットワークの**状態の変更**–ネットワーク接続または切断された、またはネットワーク上のインターネット接続が変更されました。

- **アカウントの状態の変更**–請求サイクルの終了またはデータ使用量の推定5%。

- **Wi-fi ホットスポット認証**–パブリック wi-fi ホットスポットおよび資格情報に接続しようとしています。

- **受信オペレーター通知**–オペレーターからの SMS/USSD を記述する特定の解析規則に一致する SMS/USSD メッセージ。

- **受信 sms** –オペレーターが定義した解析ルールに一致しない、受信した sms メッセージ。

- **受信 USSD** – USSD メッセージを受信しましたが、演算子で定義された解析規則に一致しません。

開発者は、アプリがアクティブでない間に使用する CPU 時間に対して厳密な制限が適用されることに注意する必要があります。 これらの制限は一部のイベントに対しては緩和されますが、システムが低電力状態のとき、または別のアプリが実行されている間に、アプリが使用するリソースを常に最小化する必要があります。

### <a name="windows-metadata-and-internet-services"></a>Windows メタデータとインターネット サービス

Windows メタデータとインターネットサービス (WMIS) は、windows デバイスエコシステムに参加するサードパーティ製の Windows のカスタマイズを提供する、クラウドベースの Windows サービスです。 モバイルブロードバンドデバイスの場合、WMIS はサービスメタデータパッケージを配信します。 これにより、Windows が Microsoft Store からモバイルブロードバンドアプリを取得し、ネットワークへの接続を初めて許可し、Windows 接続マネージャーで適切なブランド要素を表示するために必要な基本情報が提供されます。

### <a name="microsoft-store"></a>Microsoft Store

Microsoft Store は、UWP アプリが Windows 8、Windows 8.1、Windows 10 Pc に配信される主な方法です。 モバイルブロードバンドアプリの場合、デバイスが接続された後、インターネット接続が利用可能になるたびに、アプリパッケージが Microsoft Store から取得されます。 アプリパッケージは自動的にインストールされ、その時点でユーザーが使用できるようになります。 Windows 8.1 と Windows 10 では、アプリはすべての**アプリ**で利用できますが、スタート画面に自動的にピン留めされることはありません。

UWP デバイスアプリの詳細については、「 [uwp デバイスアプリ](https://docs.microsoft.com/windows-hardware/drivers/devapps/index)」を参照してください。

**メモ**   企業は、特定の条件下で UWP アプリをサイドロードすることができますが、このドキュメントでは説明しません。

### <a name="operator-metadata"></a>オペレーターのメタデータ

次に示すように、Windows 8 と Windows 10 では、演算子に関するメタデータが3つの方法で提供されます。 各メタデータオプションは、さまざまな顧客のセットを対象とします。 3種類のメタデータがどのように配信され、どのような情報が使用されるかを理解することは、お客様への対処に役立ちます。

オペレーターメタデータの詳細については、「[メタデータを使用してモバイルブロードバンドエクスペリエンスを構成する](using-metadata-to-configure-mobile-broadband-experiences.md)」を参照してください。

### <a name="windows-apn-database"></a>Windows APN データベース

Windows APN データベースは、すべての Windows 8、Windows 8.1、および Windows 10 Pc 上に存在します。 データベースは、接続情報の正確性を確保するために Windows Update を使用して定期的に更新されます。 データベースの更新は、ユーザーが要求を提供しています。 APN データベースは、インターネット接続が利用できない場合に、接続を試行する APNs や、ユーザーのリダイレクト先となる URL など、モバイルブロードバンドデバイスが検出された場合に、ネットワークに接続する方法についての情報を Windows に提供します。

この情報は、モバイルブロードバンドデバイスを接続してから数秒以内にお客様をオンラインで入手することを目的としています。 Web ブラウザーを使用してサービスを直ちに購入するか、既にサービスを購入している場合はすぐにオンラインにすることができます。

Windows APN データベースへの更新の送信の詳細については、「 [Cosa/APN データベースの送信](cosa-apn-database-submission.md)」を参照してください。

### <a name="service-metadata"></a>サービス メタデータ

サービスメタデータは、モバイルブロードバンドデバイスに接続した後、すべてのユーザーに配信されます。 従量制モバイルブロードバンドやローミングネットワークなど、ユーザーがインターネットに接続している限り、サービスメタデータは常に自動的にダウンロードされます。

この情報を使用すると、Windows 接続マネージャーのブランド要素を追加し、Microsoft Store から自動的に取得されるモバイルブロードバンドアプリを参照し、購入またはインターネット接続のために最新のモバイルブロードバンド設定を使用できるようにすることで、より充実したエクスペリエンスを実現できます。 Windows は、WMIS からの最新のサービスメタデータパッケージがあることを定期的に確認します。

サービスメタデータパッケージは、指定されたオペレーターのモバイルブロードバンドデバイスが PC で検出された場合にのみ、顧客に配信されます。 このパッケージ内の情報は、APN データベースが存在する場合は、その内容を上書きします。 サービスメタデータパッケージスキーマリファレンスの詳細については、「[サービスメタデータパッケージスキーマリファレンス](service-metadata-package-schema-reference.md)」を参照してください。

サービスメタデータパッケージを作成する方法については、[サービスメタデータを作成するための開発者ガイド](developer-guide-for-creating-service-metadata.md)を参照してください。

### <a name="provisioning-metadata"></a>メタデータのプロビジョニング

プロビジョニングメタデータは、サブスクライバーがサービスを購入した後、オペレーターの web サイトまたはモバイルブロードバンドアプリによって PC に配信されます。 プロビジョニングメタデータは XML ファイルとしてパッケージ化され、プロビジョニングエージェントによって処理され、PC のネットワーク設定を変更します。

プロビジョニングメタデータは、各サブスクライバーの個々の要件に指定できます。 モバイルブロードバンドアプリを使用すると、プロビジョニングメタデータをより高い頻度で更新することもできます。 プロビジョニングメタデータ内の情報は、APN データベースとサービスメタデータの内容を上書きします。 これは、サブスクライバーに関する最も具体的で調整された情報である傾向があるためです。
