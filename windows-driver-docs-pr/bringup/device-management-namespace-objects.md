---
title: デバイス管理用の名前空間オブジェクト
description: ACPI 5.0 仕様では、デバイスの管理に使用できる名前空間オブジェクトの種類がいくつか定義されています。
ms.assetid: 26C3312D-B1B0-4843-BF4E-1B03630C0BDD
ms.date: 06/26/2018
ms.localizationpriority: medium
ms.openlocfilehash: be11bf3d7abca39de09bda261bd5c784e35b68c2
ms.sourcegitcommit: 4b7a6ac7c68e6ad6f27da5d1dc4deabd5d34b748
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 10/24/2019
ms.locfileid: "72834509"
---
# <a name="device-management-namespace-objects"></a>デバイス管理用の名前空間オブジェクト


[ACPI 5.0 仕様](https://uefi.org/specifications)では、デバイスの管理に使用できる名前空間オブジェクトの種類がいくつか定義されています。 たとえば、デバイス識別オブジェクトには、子デバイスのハードウェアの列挙をサポートしていない、I2C などのバスに接続するデバイスの識別情報が含まれています。 その他の種類の名前空間オブジェクトは、システムリソースを指定したり、デバイスの依存関係を記述したり、どのデバイスを無効にできるかを示したりすることができます。

## <a name="device-identification-in-windows"></a>Windows でのデバイス id


Windows プラグアンドプレイは、デバイスの列挙子によって提供されるデバイス id に基づいて、デバイスドライバーを検索して読み込みます。 列挙子は、デバイスから識別情報を抽出する方法を把握しているバスドライバーです。 一部のバス (PCI、SD、USB など) には、この抽出を行うためのハードウェア定義メカニズムがあります。 Cpu (プロセッサバスや単純な周辺機器バスなど) の場合、ACPI では名前空間の id オブジェクトを定義します。

[WINDOWS acpi ドライバー](https://docs.microsoft.com/windows-hardware/drivers/kernel/acpi-driver)である acpi は、これらのオブジェクトの値をさまざまなデバイス識別子文字列にアセンブルします。これらの文字列は、ドライバーのニーズに応じて、デバイスを特に明確に識別できます。 ACPI で列挙されたデバイスを識別するために作成される文字列パターンの一部を次に示します。

```syntax
ACPI\VEN_vvv[v]&DEV_dddd&SUBSYS_sss[s]nnnn&REV_rrrr
ACPI\VEN_vvv[v]&DEV_dddd&SUBSYS_sss[s]nnnn
ACPI\VEN_vvv[v]&DEV_dddd&REV_rrrr
ACPI\VEN_vvv[v]&DEV_dddd
ACPI\vvv[v]dddd
```

デバイス用に Windows によって作成されたデバイスの id を確認するには、デバイスマネージャーを開き、列挙されたデバイスの**ハードウェア id**と**互換性のある id**のプロパティを調べます。 これらの各文字列は、デバイス用に読み込むドライバーを識別するために、INF ファイルで指定することができます。 INF 照合の順序は、最も具体的なハードウェア識別子 (最も優先度の高いドライバー) から最も低い特定の識別子 (最も優先度の低いドライバー) までです。これにより、デバイスの特定の機能についてより多くの情報を把握しているドライバーは、より少ないものを置き換えることができます。特定 (およびそのため、デバイスの機能のサブセットのみをサポートします)。

デバイス id は INF 照合にのみ使用し、デバイスドライバーで解析または処理しないようにする必要があります。 デバイスドライバーが読み込まれた特定のハードウェアを識別する必要がある場合は、インストール時に INF ファイルで適切なレジストリキーを設定することをお勧めします。 ドライバーは初期化中にこれらのキーにアクセスして、必要な情報を取得できます。

## <a name="device-identification-in-acpi"></a>ACPI でのデバイス id


### <a name="hardware-id-_hid"></a>ハードウェア ID (\_HID)

ACPI でデバイスを識別するための最小要件は、ハードウェア ID (\_HID) オブジェクトです。 \_HID は、"ABC\[D\]*xxxx*" という形式の文字列を返します。ここで、"Abc\[D\]" は、デバイスの製造元を識別する3つまたは4文字の文字列 ("Vendor ID") です。、および*xxxx*は、そのベンダーによって製造された特定のデバイス ("デバイス ID") を識別する16進数です。 ベンダー Id は、業界全体で一意である必要があります。 Microsoft では、これらの文字列が一意であることを保証するために割り当てられています。 ベンダー Id は[プラグアンドプレイ ID-PNPID 要求](https://go.microsoft.com/fwlink/p/?linkid=330999)から取得できます。

**注**  ACPI 5.0 では \_HID とその他の識別オブジェクトで PCI 割り当てベンダ id を使用することもサポートされているため、Microsoft からベンダー id を取得する必要がない場合があります。 ハードウェア id の要件の詳細については、 [ACPI 5.0 仕様](https://uefi.org/specifications)のセクション6.1.5 「\_HID (hardware ID)」を参照してください。



### <a name="compatible-id-_cid"></a>互換性 ID (\_CID)

Microsoft は、Windows に付属している受信トレイドライバーと互換性のあるデバイスに対して、ベンダー ID "PNP" を予約しています。 Windows では、デバイス用に Windows が提供するドライバーを読み込むために使用できる、このベンダー ID で使用するデバイス Id の数を定義します。 これらの識別子を返すには、互換性のある ID (\_CID) オブジェクトという別のオブジェクトを使用します。 Windows では、(\_CID によって返された) 互換性 Id を持つハードウェア Id が INF 照合およびドライバー選択で常に優先されます (\_HID によって返されます)。 この設定により、ベンダーが提供するデバイス固有のドライバーを使用できない場合に、Windows によって提供されるドライバーを既定のドライバーとして扱うことができます。 次の表に示す互換性 Id は、SoC プラットフォームで使用するために新しく作成されます。

| 互換性 ID | 説明                                           |
|---------------|-------------------------------------------------------|
| PNP0C40       | Windows 互換のボタン配列                       |
| PNP0C50       | HID-I ²の C に準拠したデバイス                         |
| PNP0C60       | 変換可能ノート pc ディスプレイセンサーデバイス              |
| PNP0C70       | センサーデバイスをドッキングする                                    |
| PNP0D10       | 標準デバッグを使用した XHCI 準拠の USB コントローラー     |
| PNP0D15       | 標準デバッグを使用しない XHCI 準拠の USB コントローラー  |
| PNP0D20       | 標準デバッグを使用しない EHCI 準拠の USB コントローラー  |
| PNP0D25       | 標準デバッグを使用した EHCI 準拠の USB コントローラー     |
| PNP0D40       | SDA 標準に準拠している SD ホストコントローラー             |
| PNP0D80       | Windows と互換性のあるシステム電源管理コントローラー |



### <a name="subsystem-id-_sub-hardware-revision-_hrv-and-class-_cls"></a>サブシステム ID (\_サブ)、ハードウェアリビジョン (\_HRV)、およびクラス (\_CLS)

ACPI 5.0 では、デバイスの特定のバージョン、統合、またはハードウェアリビジョンをより一意に識別する識別子を作成するために \_HID と共に使用できる \_SUB、\_HRV、および \_CLS オブジェクトを定義します。、、または PCI 定義デバイスクラスのメンバーシップを示します。 これらのオブジェクトは一般にオプションですが、Windows の特定のデバイスクラスで必要になる場合があります。 これらのオブジェクトの詳細については、 [ACPI 5.0 仕様](https://uefi.org/specifications)のセクション6.1 「デバイス id オブジェクト」を参照してください。

保守性を保証するために、OEM システムのデバイス Id は "4 つの部分" の Id にする必要がある Windows ハードウェア認定キット (HCK) の要件があります。 4つの部分は、ベンダー ID、デバイス ID、サブシステムベンダー (OEM) ID、およびサブシステム (OEM) デバイス ID です。 そのため、OEM プラットフォームにはサブシステム ID (\_サブ) オブジェクトが必要です。

### <a name="device-specific-method-_dsm"></a>デバイス固有の方法 (\_DSM)

\_DSM メソッドは、 [ACPI 5.0 仕様](https://uefi.org/specifications)のセクション9.14.1 「\_Dsm (デバイス固有の方法)」で定義されています。 このメソッドは、デバイス固有のその他のメソッドと競合することなくデバイスドライバーから呼び出すことができる、デバイス固有の個々のデータおよび制御関数に対してを提供します。 特定のデバイスまたはデバイスクラスの \_DSM は、他の Uuid と競合しないことが保証されている UUID (GUID) を定義します。 各 UUID には、\_DSM メソッドが、データを提供したり、ドライバーの制御関数を実行したりするために実装できる定義済みの関数のセットがあります。 クラス固有のデータとデータ形式は、デバイスクラス固有の個別の仕様で提供されています。また、「 [ACPI デバイス固有のメソッド](acpi-device-specific-methods.md)」でも説明されています。

### <a name="address-_adr-and-unique-id-_uid"></a>アドレス (\_ADR) と一意の ID (\_UID)

デバイス id には、次の3つの追加要件があります。

-   ハードウェアで列挙可能な親バス (たとえば、SDIO、USB HSIC) に接続するデバイスでは、プラットフォーム固有の機能またはコントロール (たとえば、sideband power またはウェイク割り込み) がある場合、\_HID は使用されません。 代わりに、デバイス id は親バスドライバーによって作成されます (前に説明したとおり)。 ただし、この場合、アドレスオブジェクト (\_ADR) は、デバイスの ACPI 名前空間に含まれている必要があります。 このオブジェクトを使用すると、オペレーティングシステムは、バスで列挙されたデバイスを、ACPI で説明されている機能またはコントロールに関連付けることができます。
-   特定の IP ブロックの複数のインスタンスが使用されているプラットフォームでは、各ブロックに同じデバイス id オブジェクトがあるため、オペレーティングシステムでブロックを区別できるようにするには、一意識別子 (\_UID) オブジェクトが必要です。
-   特定の名前空間スコープ内の2つのデバイスが同じ名前を持つことはできません。

## <a name="device-configuration-objects"></a>デバイス構成オブジェクト


名前空間で識別された各デバイスについて、デバイスによって消費されるシステムリソース (メモリアドレス、割り込みなど) も、現在のリソース設定 (\_CRS) オブジェクトによって報告される必要があります。 複数のリソース構成 (\_PR) と、デバイスのリソース構成 (\_SRS) を変更するためのコントロールの報告はサポートされていますが、省略可能です。

SoC プラットフォームの新は、デバイスが使用できる GPIO およびシンプルな周辺機器バス (SPB) リソースです。 詳細については、「 [General Purpose i/o (GPIO)](general-purpose-i-o--gpio-.md) 」および「[単純な周辺機器バス (SPB)](simple-peripheral-bus--spb-.md)」を参照してください。

また、SoC プラットフォームの新しいは汎用の固定 DMA 記述子です。 FixedDMA 記述子は、さまざまなシステムデバイスによる DMA コントローラーハードウェアの共有をサポートしています。 特定のシステムデバイスに静的に割り当てられた DMA リソース (要求行とチャネルレジスタ) は、FixedDMA 記述子に一覧表示されます。 詳細については、 [ACPI 5.0 仕様](https://uefi.org/specifications)の「19.5.49」、「fixeddma (Dma リソース記述子マクロ)」を参照してください。

### <a name="device-status-changes"></a>デバイスの状態の変更

ACPI で列挙されたデバイスは、さまざまな理由で無効にしたり削除したりすることができます。 ステータス (\_STA) オブジェクトは、このような状態の変更をオペレーティングシステムに伝達できるようにするために用意されています。 \_STA の詳細については、 [ACPI 5.0 仕様](https://uefi.org/specifications)の6.3.7 セクションを参照してください。 Windows は \_STA を使用して、デバイスを列挙するか、無効として表示するか、またはユーザーに表示しないかを決定します。 このファームウェアのコントロールは、多くのアプリケーション (場合によっては、ホストと機能の間の切り替えを含む) に役立ちます。

さらに、ACPI は、ASL が、ドッキングの一部として削除されているデバイスなどのプラットフォームのイベントを通知するために使用できる通知メカニズムを備えています。 一般に、ACPI デバイスの状態が変化した場合、ファームウェアは "デバイスチェック" または "バスチェック" の通知を実行して、Windows がデバイスを再列挙し、\_STA を再評価する必要があります。 ACPI 通知の詳細については、 [acpi 5.0 仕様](https://uefi.org/specifications)のセクション5.6.6 「デバイスオブジェクトの通知」を参照してください。

## <a name="enabledisable"></a>有効/無効


Windows プラグアンドプレイの一部として、ドライバーは、ユーザーまたはシステム (ドライバーの更新など) によって動的に有効化および無効化できる必要があります。

SoC デバイスは SoC チップに統合されているため、削除できません。 ほとんどの SoC デバイスのドライバーは、有効化と無効化の要件から除外することができます。 除外されていないドライバーについては、ドライバーが正常な削除をサポートしていることを示すドライバーインターフェイスがあります。 詳細については、 [Microsoft Connect web サイト](https://aka.ms/connect-redirect?DownloadID=47560)の「SoC ドライバーの PNP 要件の削減」というタイトルのドキュメントを参照してください。

ドライバーが正常な削除をサポートしていて、デバイスのハードウェアを無効にすることができる場合 (つまり、割り当てられたリソースへのアクセスを停止するようにデバイスを構成できる場合)、デバイスの ACPI 名前空間ノードには、無効 (\_) オブジェクトを含めることができます。 このメソッドは、ドライバーが削除されるたびにオペレーティングシステムによって評価されます。 \_の使用には、次の追加要件があります。

-   デバイスが無効になっている場合は、\_STA が "有効にしてリソースをデコードする" 必要があります。
-   デバイスは、デバイスハードウェアを再度有効にし、\_STA で上記のビットを設定するために、リソース設定の設定 (\_SRS) オブジェクトを提供する必要があります。

詳細については、 [ACPI 5.0 仕様](https://uefi.org/specifications)のセクション「6.2.3 (\_)」、「6.2.15 (\_SRS)」、および「6.3.7 (\_STA)」を参照してください。

## <a name="device-dependencies"></a>デバイスの依存関係


通常、特定のプラットフォームのデバイス間にはハードウェアの依存関係があります。 Windows では、すべてのデバイスがシステムで動的に変更されると正しく機能するように、すべての依存関係が記述されている必要があります (デバイスの電源が取り外され、ドライバーが停止して起動されるなど)。 ACPI では、デバイス間の依存関係について、次の方法で説明します。

1.  **名前空間の階層**。 子デバイス (別のデバイスの名前空間内のデバイスとして表示されるデバイス) であるデバイスは、親デバイスに依存します。 たとえば、USB HSIC デバイスは、接続されているポート (親) とコントローラー (祖父母) に依存します。 同様に、システムメモリ管理装置 (MMU) デバイスの名前空間内にある GPU デバイスは、MMU デバイスに依存しています。
2.  **リソース接続**。 GPIO または SPB コントローラーに接続されているデバイスは、これらのコントローラーに依存しています。 この種類の依存関係は、デバイスの \_CRS に接続リソースを含めることによって記述されます。
3.  **Opregion 依存関係**。 OpRegions を使用して i/o を実行する ASL 制御メソッドでは、依存関係は制御メソッドの評価中にのみ決定されるため、オペレーティングシステムによって暗黙的に認識されることはありません。 この問題は、プラグアンドプレイドライバーがリージョンへのアクセスを提供する GeneralPurposeIO および GenericSerialBus OpRegions に特に当てはまります。 この問題を軽減するために、ACPI では OpRegion 依存関係 (\_DEP) オブジェクトが定義されています。 \_DEP は、OpRegion (HW リソース) が制御メソッドによって参照されているデバイスの名前空間で使用する必要があります。また、参照されている OpRegion の接続リソースに対して、上記の1と2のどちらも既に適用されていません。 詳細については、 [ACPI 5.0 仕様](https://uefi.org/specifications)の「\_DEP (操作リージョンの依存関係)」を参照してください。

また、デバイスドライバー間にソフトウェアの依存関係がある場合もあります。 これらの依存関係についても説明する必要があります。 詳しくは、次のリソースをご覧ください。

-   ドライバーの読み込み順序の依存関係については、「[ドライバーの読み込み順序の指定](https://docs.microsoft.com/windows-hardware/drivers/install/specifying-driver-load-order)」を参照してください。
-   電源関係の依存関係については、以下を参照してください。

    -   [**IoInvalidateDeviceRelations**](https://docs.microsoft.com/windows-hardware/drivers/ddi/wdm/nf-wdm-ioinvalidatedevicerelations)ルーチン (電源関係の確立をトリガーするには、**デバイス\_関係\_TYPE**列挙値**powerrelations**) を使用して、 **IoInvalidateDeviceRelations**ルーチンを呼び出します)。
    -   [**IRP\_\_クエリ\_デバイス\_関係**](https://docs.microsoft.com/windows-hardware/drivers/kernel/irp-mn-query-device-relations)
    -   [バス上のデバイスの列挙](https://docs.microsoft.com/windows-hardware/drivers/wdf/enumerating-the-devices-on-a-bus)
    -   [動的列挙型](https://docs.microsoft.com/windows-hardware/drivers/wdf/dynamic-enumeration)
    -   [**WdfDeviceInitSetPnpPowerEventCallbacks**](https://docs.microsoft.com/windows-hardware/drivers/ddi/wdfdevice/nf-wdfdevice-wdfdeviceinitsetpnppowereventcallbacks)メソッド








