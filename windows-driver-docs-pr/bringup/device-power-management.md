---
title: デバイス電源管理
description: ACPI 6.3 仕様では、デバイスのデバイスの電源情報を指定する一連の名前空間オブジェクトを定義します。
ms.assetid: F57AD5A0-F459-4A20-BDBE-87C30CF957B3
ms.date: 04/20/2017
ms.localizationpriority: medium
ms.openlocfilehash: 5c212fef3a86058e5425e30ef746afc6b28ed46e
ms.sourcegitcommit: 419b015ba4ff7e29afb42069c8edee246f282be1
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 06/05/2020
ms.locfileid: "84436590"
---
# <a name="device-power-management"></a>デバイス電源管理

[ACPI 6.3 仕様](https://uefi.org/specifications)では、デバイスのデバイスの電源情報を指定する一連の名前空間オブジェクトを定義します。 たとえば、1つのオブジェクトセットで、サポートされている各デバイスの電源状態でデバイスが必要とする電源リソースを指定できます。 別のオブジェクトの種類では、ハードウェアイベントに応答して、デバイスが低電力状態から復帰する機能を記述できます。

## <a name="device-power-management-in-windows"></a>Windows でのデバイスの電源管理

システムが実行されている間 (システムが ACPI によって定義された動作状態である S0)、個々のデバイスは、アクティビティに応じてデバイスの電源状態を切り替えて電力を節約できます。 従来の PC システムでは、ACPI で定義されたスリープ状態 (S1 ~ S4) も電力を節約するために使用されますが、これらの切断された待機時間の長いスリープ状態は Windows SoC プラットフォームでは使用されません。 したがって、バッテリの寿命は、プラットフォームが実行時デバイスの電源管理を実装する方法に大きく依存します。

SoC に統合されているデバイスは、Windows Power Framework (PoFx) を使用して電源管理できます。 これらのフレームワーク統合デバイスは、SoC の電源と時計の制御の詳細を把握している SoC 固有のパワーエンジンプラグイン (マイクロ Pep) を介して PoFx によって電源管理されます。 PoFx の詳細については、「[電源管理フレームワークの概要](https://docs.microsoft.com/windows-hardware/drivers/kernel/overview-of-the-power-management-framework)」を参照してください。

SoC に統合されていない周辺機器の場合、Windows は ACPI デバイスの電源管理を使用します。 これらの ACPI で管理されたデバイスでは、デバイスドライバースタック (通常は関数またはクラスドライバー) の電源ポリシー所有者がデバイスの電源状態の移行に関する決定を行い、 [WINDOWS acpi ドライバー](https://docs.microsoft.com/windows-hardware/drivers/kernel/acpi-driver)(acpi) は ASL 制御メソッドを呼び出して、必要なプラットフォーム固有の電源コントロールを適用します。

> [!NOTE]
> また、デバイススタックによっては、SoC デバイス電源管理のために、ACPI デバイスの電源管理を使用することも、マイクロ Pep と組み合わせて使用することもできます。

「 [Acpi のデバイス電源管理](https://docs.microsoft.com/windows-hardware/drivers/bringup/device-power-management#device-power-management-in-acpi)」で説明されているように、Windows では、acpi 5.0 仕様で定義されている D3cold の電源管理機能をサポートしています。 このサポートを利用することで、デバイス、プラットフォーム、およびドライバーは、実行時のアイドル期間中にデバイスの電源を完全に削除することをオプトインできます。 この機能を使用すると、バッテリ寿命を大幅に向上させることができます。 ただし、D0 に正常に戻るためには、影響を受けるすべてのコンポーネントで電源の取り外しがサポートされている必要があります。 このため、ドライバー (バスと機能)、およびプラットフォーム自体は、ドライバーがサポートしていることを示す必要があります。 D3cold ドライバーオプトインの詳細については、「[ドライバーでの D3cold のサポート](https://docs.microsoft.com/windows-hardware/drivers/kernel/supporting-d3cold-in-a-driver)」を参照してください。

## <a name="device-power-management-in-acpi"></a>ACPI でのデバイスの電源管理

名前空間デバイスでは、最大4つのデバイスの電源状態、番号付きの D0 (完全な機能、または "オン") から D3 (関数なし、または "オフ") をサポートしています。 各状態の電力要件は異なる場合がありますが、数値が大きいほど、番号が小さい状態よりも電力の消費が少なくなります。 さらに、D3 (off) 状態には、D3hot と D3cold という2つのサブ状態があります。 D3hot サブ状態では、バス固有のソフトウェアコマンドに応答できるように、親バスでデバイスにアクセスできるようにする必要があります。 この要件と、それを満たすために使用される電力は、D3cold では削除されています。 最後に、ハードウェアイベントによってデバイスを低電力状態からスリープ解除するように設定し、必要に応じて、プラットフォームをアイドル状態から復帰させることもできます。

プラットフォームは、 \_ プラットフォーム全体の OSPM Capabilities メソッドを使用して要求された場合に、"PR3 support" 機能 (ビット 2) の OS コントロールを許可することによって、D3cold のサポートを示します。 詳細については、 [ACPI 5.0 仕様](https://uefi.org/specifications)の「6.2.10.2 the PLATFORM Wide OSPM Capabilities」セクションを参照してください。

電源管理されたデバイスは、子オブジェクトを使用して、オペレーティングシステムの電源機能を説明します。 以下のセクションでは、これらの機能とオブジェクトについて説明します。

### <a name="power-resources-and-states"></a>電源リソースと状態

デバイスは、その状態にするために必要な電源リソースのセットを一覧表示して、電源状態のサポートを宣言します。 ACPI 電源リソースは、電源装置とクロックによって駆動される電圧レールを表します。 これらのリソースは、名前空間のルートで宣言されます。 各電源リソースには、が \_ \_ 制御される ON と OFF のメソッドと、 \_ その状態を報告するための STA メソッドがあります。 詳細については、 [ACPI 5.0 仕様](https://uefi.org/specifications)のセクション7.1 「電源リソースオブジェクトの宣言」を参照してください。

[WINDOWS acpi ドライバー](https://docs.microsoft.com/windows-hardware/drivers/kernel/acpi-driver)(acpi) は、リソースを共有するデバイス間での電源の依存関係を監視します。また、これらのデバイスが電源状態を切り替えると、デバイスが実際に必要とする電力リソースだけが特定の時点で有効になります。

#### <a name="power-resource-requirements-_prx"></a>電力リソースの要件 ( \_ prx)

\_サポートされているデバイスの電源状態ごとに、x = 0、1、2、または3の電力リソース要件 (prx) オブジェクトがあります。 デバイスドライバーが新しい電源状態に移行することを決定すると、新しい状態に必要なすべての電源リソースが有効になり、使用されなくなったすべてのリソースがオフになります。

<table>
<colgroup>
<col width="33%" />
<col width="33%" />
<col width="33%" />
</colgroup>
<thead>
<tr class="header">
<th>サポートされているデバイスの状態</th>
<th>使用するリソース要件オブジェクト</th>
<th>要件オブジェクトに含めるリソース</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>D0 (必須)</td>
<td>_PR0</td>
<td><p>デバイスの全機能に必要なすべての電源とクロック。</p></td>
</tr>
<tr class="even">
<td>D1</td>
<td>_PR1</td>
<td><p>クラスによって定義された、この状態の機能低下に必要なすべての電源またはクロック。</p></td>
</tr>
<tr class="odd">
<td>D2</td>
<td>_PR2</td>
<td><p>クラスによって定義された、この状態の機能低下に必要なすべての電源またはクロック。</p></td>
</tr>
<tr class="even">
<td>D3hot (必須)</td>
<td>_PR3</td>
<td><p>バス上にデバイスを表示し、バス固有のコマンドに応答するために必要な電源またはクロックのみ。</p></td>
</tr>
</tbody>
</table>

 > [!NOTE]
 > 特定のプラットフォームで D3cold 機能がサポートされていて、デバイスのデバイスドライバーが D3cold に設定されている場合、デバイスの \_ PR3 電源リソースは、他のデバイスで使用されていない場合は、D3cold への移行後にオフになることがあります。

D3cold をサポートするデバイスの電力リソース要件の詳細については、「 [D3cold のファームウェア要件](firmware-requirements-for-d3cold.md)」を参照してください。

#### <a name="device-power-state-_psx"></a>デバイスの電源状態 ( \_ PSx)

\_サポートされているデバイスの電源状態の Dx ごとに、PSx という電源状態のメソッドがあります。 x = 0、1、2、または3です。 このメソッドは省略可能ですが、存在する場合は、状態の電源リソースがオフになってから、状態の電源リソースが有効になる前に呼び出されます。 \_PSx は、電源サイクルに関して必要なプラットフォーム固有のアクションを実行することを目的としています。 \_PSx は、関数ドライバーに割り当てられているデバイスレジスタにアクセスしたり、バスドライバーに割り当てられているアクセスバス標準のレジスタにアクセスしたり、電源リソースのオンとオフを切り替える必要があります。これは、Acpi 用に予約されている操作です。

### <a name="wake-capabilities"></a>ウェイク機能

電源管理されたデバイスは、電力が不足しているときにイベントを検出し、それらを処理するためにプラットフォームをウェイクアップさせることができます。 この機能を有効にするには、プラットフォームとデバイスの両方の機能に関する情報が必要です。

#### <a name="sx-device-wake-state-_sxw"></a>Sx デバイスのウェイク状態 ( \_ SxW)

特定のプラットフォームにおいて、ウェイクアップ機能をサポートするデバイスの状態と、ウェイクアップイベントに応答できるシステム状態との間には、特定のマッピングがあります。 ACPI は、 \_ この情報をオペレーティングシステムに提供するために、SxW オブジェクトを定義します。 サポートされているシステム電源の状態 (Sx) ごとに SxW オブジェクトがあります。 SoC プラットフォームは常に S0 であるため、ここでは S0W だけが重要です \_ 。 このオブジェクトは、デバイスのウェイク信号に応答して低電力アイドル状態から復帰するプラットフォームの機能を指定します。 このオブジェクトは、システムの低電力アイドル時のデバイスのターゲット D 状態を判断するために Windows によって使用されます。 S0W の詳細については \_ 、 \_ [ACPI 5.0 仕様](https://uefi.org/specifications)のセクション7.2.20 「S0W (S0 Device Wake State)」を参照してください。

ほとんどの SoC プラットフォームでは、アイドル状態のときにデバイスが D3 状態に積極的に電力管理され、デバイスがこの状態にある間は、システムが低電力アイドル状態からスリープ解除できるようになっています。 このようなシステムの場合、 \_ S0W オブジェクトは 3 (または、D3cold もサポートしている場合は 4) を返します。 ただし、すべての D 状態は、電源がオフになっている最も低い状態として指定でき、一部のデバイスクラスまたはバスでは異なる値が使用されます。 たとえば、SDIO および USB 接続デバイスでは、この状態に対して状態 D2 が使用されます。

> [!NOTE]
> Windows 7 から Windows 8 または Windows 8.1 へのデバイスドライバーの移行を容易にするために、デバイスでも S4W の提供が必要になる場合があり \_ ます。 現時点では、この要件を持つ唯一のデバイスクラスはネットワーク (Ndis) です。

#### <a name="wake-capable-interrupts-_crs"></a>ウェイク対応割り込み ( \_ CRS)

デバイスのリソースの説明は、割り込みを "ウェイク対応" (ExclusiveAndWake または SharedAndWake) としてマークすることによって、デバイスがウェイクイベントを検出してシグナリングできることを示します。 Windows およびデバイスドライバーは、デバイスが低電力状態に移行したときに有効になるように、このような割り込みを特別に処理します。 詳細については、「6.4.3.6」の「Interrupt and GpioInt リソース記述子」セクション、「拡張割り込み記述子」、および「6.4.3.8.1」 [5.0](https://uefi.org/specifications)の「GPIO 接続記述子」を参照してください。

### <a name="wake-enablement"></a>ウェイク有効化

ユーザーシナリオまたはシステムポリシーによっては、スリープ状態に対応しているデバイスがスリープ状態にならない場合があります。 そのため、デバイスがアイドル状態のときに、ウェイク対応の割り込みが有効になっていたり、有効になっていない場合があります。 Windows では、割り込みを有効にするだけでなく、次のメカニズムを使用してデバイスの wake on を有効にします。

#### <a name="device-sleep-wake-_dsw"></a>デバイスのスリープウェイク ( \_ DSW)

ACPI で \_ は、オペレーティングシステムが次のスリープまたは低電力のアイドル期間について ACPI プラットフォームのファームウェアに通知する手段として、DSW オブジェクトを定義します。 このオブジェクトは省略可能であり、プラットフォームがプラットフォーム固有のウェイクアップハードウェアを事前に構成する必要がある場合にのみ使用されます。 デバイスのターゲット D 状態と、ターゲットのシステムの状態が両方とも提供されます。 D 状態と S 状態の組み合わせは、デバイスの SxW オブジェクトによって提供される情報に常に準拠し \_ ます。

#### <a name="power-resources-for-wake-_prw"></a>Wake の電源リソース ( \_ PRW)

場合によっては、デバイスで wake を有効にするために、追加の電源リソースが有効になっている必要があります。 この場合、デバイスは、 \_ 追加の電源リソースを一覧表示する PRW オブジェクトを提供できます。 [WINDOWS acpi ドライバー](https://docs.microsoft.com/windows-hardware/drivers/kernel/acpi-driver)(acpi) は、通常のようにこれらの電力リソースを管理し、デバイスが必要とするとき (つまり、ウェイクアップが有効になっているデバイス) に電源がオンになっていることを確認し、それ以外の場合はオフにします。

\_PRW は、従来の (フル ACPI ハードウェア) PC プラットフォームのウェイクアップ機能を定義するためにも使用されます。
