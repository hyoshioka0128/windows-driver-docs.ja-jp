---
title: ファームウェア更新の状態
description: すべてのファームウェア更新プログラムが適用され、後続の Windows OS ローダーの起動時にすべての更新プログラムの結果が ESRT に反映されることが想定されています。
ms.assetid: 988B1E95-2268-4B4F-B0C6-3C965FCD1B1C
ms.date: 07/21/2020
ms.localizationpriority: medium
ms.openlocfilehash: 6973aed238f784fc47c02bb7b0f57a744c228489
ms.sourcegitcommit: 67fb9981ca51df198dfb6af9bf4987843266f8ac
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 07/22/2020
ms.locfileid: "86879098"
---
# <a name="firmware-update-status"></a>ファームウェア更新の状態

この時点で、すべてのファームウェア更新プログラムが適用され、後続の Windows OS ローダーの起動時にすべての更新プログラムの結果が**Esrt**に反映されることが期待されます。 [Esrt テーブル定義](esrt-table-definition.md)の esrt の例と、ファームウェアリソース更新ドライバーパッケージの作成に関するサンプル ([更新ドライバーパッケージの作成](authoring-an-update-driver-package.md)時) に戻ります。バージョン2のファームウェアが正常にファームウェアによって適用された場合、新しい esrt テーブルはこれを反映します。 テーブルの唯一の違いは、正常に適用された新しいファームウェアバージョンを反映するために、システムファームウェアリソースエントリのファームウェアバージョンと最終試行バージョンフィールドが変更されたことです。

| フィールド | 値 | 解説 |
|--|--|--|
| ファームウェアのリソース数 | 2 | このテーブルには、2つのファームウェアリソースエントリが含まれています。 |
| ファームウェアリソースの最大値 | 2 | このテーブル割り当てには、最大2つのリソースを説明するのに十分な領域が含まれています。 |
| ファームウェアリソースバージョン | 1 | このテーブルで使用されるファームウェアリソースエントリ形式のバージョンは1です。 |
| ファームウェアリソースエントリの配列 | ファームウェアリソースエントリ0 |  |
| ファームウェアクラス | (システム \_アップデート | この GUID は、PnP 経由で更新するためのシステムファームウェアを識別します。 |
| ファームウェアの種類 | 1 | システムファームウェアの種類は1です。 |
| ファームウェア バージョン | 2 | 現在のシステムファームウェアのバージョンは2です。 |
| サポートされている最低のファームウェアバージョン | 2 | ファームウェアをバージョン2より前のバージョンにロールバックできないように、サポートされている最低のファームウェアバージョンを2に変更します。 この値は、通常、ファームウェアの更新プログラムにセキュリティ修正プログラムが含まれている場合に変更されます。 |
| カプセルフラグ | 0 | システムファームウェアでは、カプセルのプライベート更新フラグは定義されません。 |
| 最終試行バージョン | 2 | 更新が試行された最後のシステムファームウェアのバージョンは2です。 |
| 前回の試行の状態 | 0 | システムファームウェアの最後の更新が正常に行われました。 |
|  | ファームウェアリソースエントリ1 |  |
| ファームウェアクラス | (デバイス \_アップデート | この GUID は、PnP 経由で更新するためのデバイスファームウェアを識別します。 |
| ファームウェアの種類 | 2 | デバイスのファームウェアの種類は2です。 |
| ファームウェア バージョン | 1 | 現在のデバイスファームウェアのバージョンは1です。 |
| サポートされている最低のファームウェアバージョン | 1 | サポートされている最低のファームウェアバージョンを1として保持します。 ファームウェアは、必要に応じてバージョン1にロールバックできます。 |
| カプセルフラグ | 0x8010 | デバイスファームウェアは、カプセルのプライベート更新フラグ (0x8010) を定義します。 |
| 最終試行バージョン | 1 | 更新が試行された最後のデバイスファームウェアのバージョンは1です。 |
| 前回の試行の状態 | 0 | 前回のデバイスのファームウェアの更新が正常に行われました。 |

ファームウェアが正常に適用されない場合、 **Esrt**のファームウェアバージョン、最終試行バージョン、および最後の試行ステータスエントリに、失敗した更新試行が反映されます。 たとえば、システムがファームウェアのバージョン1をバージョン2に更新しようとして、正常に適用できなかった場合は、ファームウェアバージョン = 1、最後の試行バージョン = 2、および最後の試行状態! = 0 になります。 (つまり、最後の試行の状態は、エラーが発生した原因を示す0以外の適切なエラーコードに設定されます。 このエントリの有効なエラーコードの一覧については、「 [Esrt テーブルの定義](esrt-table-definition.md)」を参照してください。

標準の更新ポリシーでは、ファームウェアのバージョンが増えるだけであることが規定されていますが、次の「[ファームウェアの更新のロールバック](#rolling-back-firmware-updates)」セクションで説明されているポリシー設定を使用して、テスト目的でこのポリシーを無効にすることができます。

## <a name="system-reset"></a>システムのリセット

システムのリセットを使用すると、エンドユーザーはシステムを工場出荷時の設定に戻すことができます。 これを実現するには、製造プロセス中にシステムに事前に読み込まれている Windows イメージを再インストールします。 ドライバーとアプリケーションを含む OS 全体が再インストールされます。

> [!NOTE]
> セキュリティの境界を越えて**ファームウェアのロールバックを防止**するセキュリティ要件により、システムのリセットでは、ファクトリに展開されている元のファームウェアに一致するようにファームウェアのバージョンをロールバックすることはできません。 つまり、ファームウェアのすべてのバージョンは、そのプラットフォームで出荷されたすべてのドライバーおよびオペレーティングシステムのバージョンと下位互換性がある必要があります。 ファームウェアに互換性がない場合は、ユーザーがシステムを製造元に返す可能性があります。

## <a name="rolling-back-firmware-updates"></a>ファームウェア更新プログラムをロールバックしています

場合によっては、更新プログラムのテスト中にファームウェアの更新プログラムのロールバックが必要になることがあります。 報告された各 ESRT のファームウェアリソースには、次のレジストリキーに**HKLM\SYSTEM\CurrentControlSet\Control\FirmwareResources**というエントリがあります。

エントリは、 **Esrt**のリソースを報告するために使用される GUID と同じ名前を持つキーです。 ファームウェアのロールバックを許可するには、[**ポリシー** ] という**REG_DWORD**値を作成し、値を**1**に設定します。 特定のファームウェアリソースは、 **Esrt**で指定されている、サポートされている最低のファームウェアバージョンにのみロールバックできます。 これは、ファームウェアに重要なセキュリティ修正が加えられたポイントを超えるファームウェアのロールバックを防止するためです。 ロールバックしているファームウェアのバージョンがこれらの条件を満たしている場合、OS ローダーは古いバージョンに更新されます。

## <a name="related-topics"></a>関連トピック

[ESRT テーブルの定義](esrt-table-definition.md)  

[プラグ アンド プレイ デバイス](plug-and-play-device.md)  

[更新プログラム ドライバー パッケージの作成](authoring-an-update-driver-package.md)  

[更新プログラムの処理](processing-updates.md)  

[UEFI 環境からのデバイス I/O](device-i-o-from-the-uefi-environment.md)  

[シームレスな危機防止と回復](seamless-crisis-prevention-and-recovery.md)  
