---
title: I2C のプラグアンドプレイサポート
description: このセクションでは、I ² C で HID をサポートするデバイスのプラグアンドプレイサポートについて説明します。
ms.assetid: 2D51B1B7-345E-4311-81D6-8A14CE2B44FE
ms.date: 04/20/2017
ms.localizationpriority: medium
ms.openlocfilehash: 1182e8d65061c647c3dfd434b4c393717dbe6b57
ms.sourcegitcommit: ca5045a739eefd6ed14b9dbd9249b335e090c4e9
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 07/06/2020
ms.locfileid: "85968455"
---
# <a name="plug-and-play-support-for-i2c"></a>I2C のプラグアンドプレイサポート


このセクションでは、I ² C トランスポートで HID をサポートするデバイスのプラグアンドプレイサポートについて説明します。

### <a name="driver-loading"></a>ドライバーの読み込み

Windows は、ハードウェア識別子と INF 間の互換性のある識別子の一致に基づいて、HID I ² C クラスドライバーを読み込みます。 この識別子は、Advanced Configuration and Power Interface (ACPI) によって生成されます。 ハードウェア識別子は、ACPI の I ² C デバイスノード用に生成されます。 すべての HID I ² C 互換デバイスは、一意のハードウェア識別子に加えて、互換性識別子を公開する必要があります。

ACPI 5.0 仕様には、HID クラスデバイスのサポートが含まれています。 HID I ² C の ACPI 定義は次のとおりです。

|                           |                                             |             |                                                 |                                                                                      |
|---------------------------|---------------------------------------------|-------------|-------------------------------------------------|--------------------------------------------------------------------------------------|
| フィールド                     | 値                                       | ACPI オブジェクト | フォーマット                                          | コメント                                                                             |
| 互換性 ID             | PNP0C50                                     | \_CID       | ACPI0C50 または PNP0C50 の形式の文字列     | 互換 Id                                                                         |
| Hardware ID (ハードウェア ID)               | ベンダー固有                             | \_HID       | VVVVdddd の形式の文字列 (例: NVDA0001) | VendorID + DeviceID                                                                  |
| Subsystem                 | ベンダー固有                             | \_サブ       | VVVVssss の形式の文字列 (例: INTL1234) | SubVendorID + SubSystemID                                                            |
| ハードウェアのリビジョン         | ベンダー固有                             | \_HRV       | 0xRRRR (2byte リビジョン)                         | RevisionID                                                                           |
| 現在のリソースの設定 | ベンダー固有                             | \_CRS       | バイトストリーム                                     | \_I2C コントローラーと gpio 割り込み resp には、I2CSerialBus と gpio INT を含める必要があります。 |
| デバイス固有の方法    | GUID {3CDFF6F747 2674555-AD05-B30A3D8938DE} | \_DSM       | パッケージ                                         | HID 記述子アドレスを含む構造体を定義します。                        |

 

すべての HID I ² C デバイスには、次の必須フィールドが用意されている必要があります。

-   互換性 ID
-   Hardware ID (ハードウェア ID)
-   ハードウェアのリビジョン
-   現在のリソースの設定
-   デバイス固有の方法

詳細については、「Advanced Configuration and Power Interface (ACPI) 5.0 仕様」を参照してください。

次に、ランダム HID I ² C デバイスのハードウェア Id と互換性 Id の例を示します。 これらの詳細は、"ベンダ固有" クラスの最上位レベルのコレクションを1つ持つ HID として報告するサンプルデバイスに基づいています。

Advanced Configuration and Power Interface (ACPI) は、次のハードウェア Id と互換性 Id を生成して、HID I ² C トランスポートドライバーを読み込みます。

**ハードウェア識別子**: 互換性のある識別子

**ACPI \\Vid \_ xxxx&Pid \_ Yyyy&Rev \_ zzzz;**: ACPI \\ PNP0C50

**ACPI \\Vid \_ xxxxPid \_ yyyy;**: 

**ACPI \\ xxxxyyyy;**: 


 

前の例では、 \_ サンプルデバイスの HID ACPI メソッドから抽出された値を使用して、ハードウェア ID が生成されています。 互換性 ID は、 \_ サンプルデバイスの CID ACPI メソッドから抽出された値を使用して生成されます。 I2C 経由の HID の互換性のある ID は、バージョン1.0 では常に PNP0C50 である必要があります。

**メモ**   INF を指定する場合は、前の表の左側の列にあるハードウェア識別子のみを使用する必要があります。 (右側の列には、互換性のある識別子を使用しないでください)。

 

HIDClass.sys コンポーネントによって生成される HID クライアントデバイスノードのハードウェア ID は次のとおりです。

**ハードウェア識別子**: 互換性のある識別子

**HID \\VEN \_ MSFT&DEV \_ 0010&REV \_ 0002&Col01;**: N/A

**-HID \\VEN \_ MSFT&DEV \_ 0010&Col01 HID \\ MSFT0010&Col01;**: N/A

**-HID \\ \*MSFT0010Col01**: N/A

**-HID \_デバイス \_ アップ: FF00 \_ u: 0001;**: N/A

**-HID \_デバイス**: 該当なし


 

ハードウェア ID は HIDClass.sys によって生成され、すべてのトランスポートで同一です。 この識別子は、HIDI2C.sys から (ACPI から抽出された) HIDClass.sys に渡される値に基づいています。

### <a name="device-enumeration-sequence"></a>デバイスの列挙シーケンス

HID I ² C デバイスドライバー (HIDI2C.Sys) が読み込まれると、I ² C バスでデバイスとの通信が開始されます。 ドライバーが実行する最初の操作は、デバイスの列挙シーケンスです。

列挙シーケンスの一覧を次に示します。 この一覧の順序は、Windows の将来のバージョンで変更される可能性があることに注意してください。

1.  システム BIOS から HID I ² C デバイスの ACPI ASL コードを取得します。
2.  デバイスから HID 記述子を取得します。
    -   HID 記述子アドレスの書き込み
    -   HID 記述子の読み取り

3.  \_デバイスに電力を供給します。
    -   書き込みセットの \_ パワーコマンド

4.  デバイスへのリセット (ホスト側開始リセット) を発行します。
    -   書き込みリセットコマンド
    -   デバイスが GPIO 割り込みをアサートする
    -   入力レジスタから値 (0x00 0x00) を読み取ります

5.  デバイスからレポート記述子を取得します。
    -   レポート記述子のアドレスを書き込む
    -   レポート記述子の読み取り

ホストがデバイスでいずれかの手順1-5 を正常に完了できない場合、HIDI ² C ドライバーがエラー値*コード 10*で読み込まれることがあります。 これらのコマンドのいずれにも組み込まれていない再試行ロジックはありません。

**メモ**   手順 4. と 5. を並行して実行し、I ²の時間を最適化することができます。 レポートの記述子は静的で、(b) 非常に長いため、Windows 8 はデバイスからの応答を待機している間に5個の要求を発行する場合があります。

 

### <a name="supported-hid-ic-commands"></a><a href="" id="supported-hid-i2c-commands"></a>サポートされている HID I ² C コマンド

HIDI2C.SYS ドライバーは次のコマンドをサポートします。

|                 |                                                |                                                                                                                                                                                                       |
|-----------------|------------------------------------------------|-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| コマンド         | 用途                                  | 使用する場合                                                                                                                                                                                        |
| Reset           | Windows では、ホスト側開始のリセットがサポートされています。     | Windows は、次のシナリオでこのコマンドを発行します-デバイスの初期化-無効化/有効化-アンインストール/再インストール                                                                         |
| レポートの取得/設定 \_ | Windows では、Get/Set レポートコマンドがサポートされてい \_ ます。 | Windows は、次のシナリオでこのコマンドを発行します。 HID クライアントドライバーが get/set 機能レポート要求を発行すると、HID クライアントドライバーが同期入力/出力レポートを発行するとき |
| 電源の設定 \_      | Windows は、Set Power コマンドをサポートしています \_        | このコマンドは、次のような場合に、システムの電源が切れている場合は、システムがシャットダウンされたときに実行されます。                               |

 

 

 




